<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Unlight</title>
<style>
.wrapper {
	position: absolute;
	left: 0px;
	top: 0px;
	width: 500px;
	height: 800px;
	background: #000;
}
</style>
</head>
<body width="100%" height="100%">
</body>
<script>
/*******************************************************************************
 *	Logs
 */
/*******************************************************************************
 *	Utils
 */
var eventDispatcher = (function () {
	var inst = {};
	var map = {};
	var dispose = function () {
		inst = null;
		map = null;
	};
	var add = function ( action, listener ) {
		if ( !map || typeof action !== 'string' || action === '' || typeof listener !== 'function' ) {
			return;
		}
		if ( !map[action] ) {
			map[action] = [];
		}
		map[action].push( listener );
	};
	var remove = function ( action, listener ) {
		if ( !map ) {
			return;
		}
		if ( typeof action !== 'string' || action === '' ) {
			map = {};
			return;
		}
		if ( !map[action] ) {
			return;
		}
		if ( typeof listener !== 'function' ) {
			map[action] = [];
			return;
		}
		var i = 0;
		var list = map[action];
		for(i = 0; i < list.length; i++) {
			if ( list[i] === listener ) {
				list.splice( i, 1 );
				return;
			}
		}
	};
	var dispatch = function ( action, data ) {
		if ( !map || typeof action !== 'string' || action === '' || !map[action] ) {
			return;
		}
		var i = 0;
		var list = map[action];
		for(i = 0; i < list.length; i++) {
			var listener = list[i];
			listener( data );
		}
	};
	inst.dispose = dispose;
	inst.add = add;
	inst.dispatch = dispatch;
	inst.remove = remove;
	return inst;
} ());

var log = function ( value ) {
	console.log( value );
};

var utils = (function () {
	var inst = {};
	var hasProp = {}.hasOwnProperty;
	var objHasKey = function ( obj, key ) {
		if (
			typeof obj !== 'object' ||
			obj === null
		) {
			return false;
		}
		return hasProp.call( obj, key );
	};
	var findElement = function ( obj, keys, defaultValue ) {
		var rslt = null;
		if ( typeof defaultValue !== 'undefined' ) {
			rslt = defaultValue;
		}
		if (
			!obj ||
			!( keys instanceof Array )
		) {
			return rslt;
		}
		
		var buff = obj;
		for(var i = 0; i < keys.length; i++) {
			var key = keys[i];
			if ( !buff.hasOwnProperty( key ) ) {
				break;
			}
			buff = buff[key];
			if ( i === keys.length - 1 ) {
				rslt = buff[key];
			}
		}
		return rslt;
	};
	var createConst = function ( list ) {
		var rslt = {};
		if ( !( list instanceof Array ) ) {
			return rslt;
		}
		for(var i = 0; i < list.length; i++) {
			var key = list[i];
			rslt[key] = key;
		}
		return rslt;
	};
	var createConstAsIdx = function ( list ) {
		var rslt = {};
		if ( !( list instanceof Array ) ) {
			return rslt;
		}
		for(var i = 0; i < list.length; i++) {
			var key = list[i];
			rslt[key] = i;
		}
		return rslt;
	};
	
	inst.hasProp = hasProp;
	inst.objHasKey = objHasKey;
	inst.findElement = findElement;
	inst.createConst = createConst;
	inst.createConstAsIdx = createConstAsIdx;
	return inst;
} ());

/*******************************************************************************
 *	Data
 */
	
var ActionCardType = utils.createConstAsIdx([
	  'NONE'
	, 'ANY'
	, 'SWORD'
	, 'GUN'
	, 'SHIELD'
	, 'MOVE'
	, 'STAR'
	, 'HEAL'
	, 'DETOX'
	, 'DRAW'
	, 'THROW'
]);

var ActionCardStage = utils.createConst([
	  'FREE' // move / atk / guard
	, 'FIGHT' // atk / guard
]);

var SkillTriggerStage = utils.createConst([ 'ALL', 'ATK', 'DEF', 'MOV' ]);
var SkillTriggerDistance = utils.createConst([ 'NONE', 'S', 'M', 'SM', 'L', 'SL', 'ML', 'SML' ]);
var SkillCardCalc = utils.createConst([ 'SUM_MIN', 'SUM_EQU', 'SUM_MAX', 'ONE_MIN', 'ONE_EQU', 'ONE_MAX' ]);

var SkillResultStage = utils.createConst([
	  'NONE'
	, 'ATK_DAMAGE_CALCED_A'
	, 'ATK_INC_A'
	, 'ATK_THROW_CARD_A'
	, 'DEF_COUNTERATK_A'
	, 'DEF_INC_A'
	, 'DEF_OVERCOME_CALCED_A'
	, 'MOV_BEFORE_ACT_A'
]);

var SkillResultTarget = utils.createConst([
	  'NONE'
	, 'ATK_ATKPOWER'
	, 'ATK_HP'
	, 'ATK_CARDHOLD'
	, 'DEF_DEFPOWER'
	, 'DEF_HP'
	, 'DEF_CARDHOLD'
	, 'VARIBLE'
]);

var SkillResultCalc = utils.createConst([
	  'NONE'
	, 'CARDHOLD_ADD_001' // + c01
	, 'CARDHOLD_THROW_001' // - c01
	, 'VALUE_ADD_001' // v = v + c01
	, 'VALUE_ADD_002' // v = v + roundUp( c01 * c02 )
	, 'VALUE_CALC_001'
	, 'VALUE_MINUS_001' // v = v - c01
	, 'VALUE_MULTI_001' // v = roundDown( v * c01 )
	, 'VAR_SET_BYATK_DAMAGE_CALCED'
	, 'VAR_SET_BYATK_HURT_AMOUNT'
	, 'VAR_SET_BYATK_SWORD_AMOUNT'
	, 'VAR_SET_BYDEF_OVERCOME_CALCED'
]);

var SkillVarible = utils.createConst([
	  'NONE'
	, 'COUNTER_ATK'
	, 'HURT_AMOUNT'
	, 'SWORD_AMOUNT'
	, 'THROW_CARD'
]);

var dataBase = (function () {
	var inst = {};
	
	var createTable = function ( _keyName ) {
		var inst = {};
		var dataArr = [];
		var idxMap = {};
		var keyName = _keyName;
		
		var dispose = function () {
			inst = null;
			dataArr = null;
			idxMap = null;
		};
		
		var selectByKey = function ( _key ) {
			if ( !inst ) {
				return null;
			}
			if ( !utils.hasProp.call( idxMap, _key ) ) {
				return null;
			}
			var idx = idxMap[_key];
			var item = dataArr[idx];
			var rslt = {};
			for(var key in item) {
				rslt[key] = item[key];
			}
			return rslt;
		};
		
		var getSize = function () {
			if ( !inst ) {
				return 0;
			}
			return dataArr.length;
		};
		
		var insert = function ( data ) {
			if ( !inst || !utils.objHasKey( data, keyName ) ) {
				return false;
			}
			
			var key = data[keyName];
			if ( utils.hasProp.call( idxMap, key ) ) {
				var idx = idxMap[key];
				dataArr[idx] = data;
			} else {
				idxMap[key] = dataArr.length;
				dataArr.push( data );
			}
		};
		
		inst.dispose = dispose;
		inst.getSize = getSize;
		inst.insert = insert;
		inst.selectByKey = selectByKey;
		return inst;
	};
	
	var actionCards = (function () {
		var inst = {};
		
		var generateCardId = function ( type0, value0, type1, value1 ) {
			var t0 = type0;
			var v0 = value0;
			var t1 = type1;
			var v1 = value1;
			if ( t0 < t1 || ( t0 === t1 && v0 > v1 ) ) {
				t0 = type1;
				v0 = value1;
				t1 = type0;
				t1 = value0;
			}
			if ( t1 === 0 ) {
				t1 = 0;
				v1 = v0;
			}
			return type0 * 1000 + type1 * 100 + value0 * 10 + value1;
		};
		
		var typeTable = (function () {
			var table = createTable( 'id' );
			
			var insert = function ( id, name, stage, remark ) {
				table.insert( { id: id, name: name, stage: stage, remark: remark } );
			};
			
			insert( ActionCardType.SWORD,	'Sword', ActionCardStage.FREE, '' );
			insert( ActionCardType.GUN,		'Gun', ActionCardStage.FREE, '' );
			insert( ActionCardType.SHIELD,	'Shield', ActionCardStage.FREE, '' );
			insert( ActionCardType.MOVE,	'Move', ActionCardStage.FREE, '' );
			insert( ActionCardType.STAR,	'Star', ActionCardStage.FREE, '' );
			insert( ActionCardType.HEAL,	'Heal', ActionCardStage.FREE, '' );
			insert( ActionCardType.DETOX,	'Detoxification', ActionCardStage.FREE, '' );
			insert( ActionCardType.DRAW,	'Draw cards', ActionCardStage.FREE, '' );
			insert( ActionCardType.THROW,	'Throw cards', ActionCardStage.FIGHT, '' );
			
			log( 'db - typeTable >> ' + table.getSize() );
			return table;
		} ());
		
		var cardTable = (function () {
			var table = createTable( 'id' );
			
			var insert = function ( type0, value0, type1, value1 ) {
				var id = generateCardId( type0, value0, type1, value1 );
				table.insert( { id: id, type0: type0, value0: value0, type1: type1, value1: value1 } );
			};
			
			var i = 0;
			var j = 0;
			var k = 0;
			var m = 0;
			
			for(i = 0; i <= 4; i++) {
				for(j = i; j <= 4; j++) {
					var t0 = 0;
					var t1 = 0;
					switch ( i ) {
					case 0: t0 = ActionCardType.SWORD; break;
					case 1: t0 = ActionCardType.GUN; break;
					case 2: t0 = ActionCardType.SHIELD; break;
					case 3: t0 = ActionCardType.MOVE; break;
					case 4: t0 = ActionCardType.STAR; break;
					}
					switch ( j ) {
					case 0: t1 = ActionCardType.SWORD; break;
					case 1: t1 = ActionCardType.GUN; break;
					case 2: t1 = ActionCardType.SHIELD; break;
					case 3: t1 = ActionCardType.MOVE; break;
					case 4: t1 = ActionCardType.STAR; break;
					}
					for(k = 0; k <= 9; k++) {
						for(m = k; m <= 9; m++) {
							insert( t0, k, t1, m );
						}
					}
				}
			}
			
			for(i = 1; i <= 9; i++) {
				insert( ActionCardType.HEAL, i, 0, 0 );
				insert( ActionCardType.DETOX, i, 0, 0 );
				insert( ActionCardType.DRAW, i, 0, 0 );
				insert( ActionCardType.THROW, i, 0, 0 );
			}
			
			log( 'db - cardTable >> ' + table.getSize() );
			return table;
		} ());
		
		var cardSetTable = (function () {
			var table = createTable( 'id' );
			
			var insert = function ( id, list ) {
				table.insert( { id: id, list: list } );
			};
			
			insert( 1, [
				  { id: generateCardId( ActionCardType.MOVE, 1, ActionCardType.GUN, 1 ), num: 6 }
				, { id: generateCardId( ActionCardType.MOVE, 1, ActionCardType.GUN, 2 ), num: 2 }
				, { id: generateCardId( ActionCardType.MOVE, 1, ActionCardType.GUN, 3 ), num: 2 }
				, { id: generateCardId( ActionCardType.MOVE, 1, ActionCardType.SHIELD, 1 ), num: 6 }
				, { id: generateCardId( ActionCardType.MOVE, 1, ActionCardType.SHIELD, 2 ), num: 2 }
				, { id: generateCardId( ActionCardType.MOVE, 1, ActionCardType.SHIELD, 3 ), num: 1 }
				, { id: generateCardId( ActionCardType.MOVE, 2, ActionCardType.STAR, 3 ), num: 3 }
				, { id: generateCardId( ActionCardType.SWORD, 1, ActionCardType.SHIELD, 1 ), num: 4 }
				, { id: generateCardId( ActionCardType.SWORD, 2, ActionCardType.SHIELD, 1 ), num: 2 }
				, { id: generateCardId( ActionCardType.SWORD, 2, ActionCardType.SHIELD, 2 ), num: 2 }
				, { id: generateCardId( ActionCardType.SWORD, 3, ActionCardType.SHIELD, 3 ), num: 2 }
				, { id: generateCardId( ActionCardType.SHIELD, 5, 0, 0 ), num: 1 }
				, { id: generateCardId( ActionCardType.SWORD, 1, ActionCardType.GUN, 1 ), num: 4 }
				, { id: generateCardId( ActionCardType.SWORD, 2, ActionCardType.GUN, 1 ), num: 2 }
				, { id: generateCardId( ActionCardType.SWORD, 2, ActionCardType.GUN, 2 ), num: 2 }
				, { id: generateCardId( ActionCardType.SWORD, 3, ActionCardType.GUN, 3 ), num: 2 }
				, { id: generateCardId( ActionCardType.SWORD, 6, 0, 0 ), num: 1 }
				, { id: generateCardId( ActionCardType.SWORD, 1, ActionCardType.STAR, 1 ), num: 1 }
				, { id: generateCardId( ActionCardType.SWORD, 2, ActionCardType.STAR, 1 ), num: 1 }
				, { id: generateCardId( ActionCardType.SWORD, 4, ActionCardType.STAR, 1 ), num: 2 }
				, { id: generateCardId( ActionCardType.SWORD, 5, ActionCardType.STAR, 2 ), num: 2 }
				, { id: generateCardId( ActionCardType.GUN, 4, 0, 0 ), num: 1 }
				, { id: generateCardId( ActionCardType.GUN, 2, ActionCardType.STAR, 1 ), num: 1 }
				, { id: generateCardId( ActionCardType.GUN, 3, ActionCardType.STAR, 2 ), num: 1 }
				, { id: generateCardId( ActionCardType.GUN, 4, ActionCardType.STAR, 1 ), num: 2 }
				, { id: generateCardId( ActionCardType.GUN, 5, ActionCardType.STAR, 2 ), num: 2 }
			] )
			
			log( 'db - cardSetTable >> ' + table.getSize() );
			return table;
		} ());
		
		inst.type = typeTable;
		inst.card = cardTable;
		inst.cardSet = cardSetTable;
		
		return inst;
	} ());

	var charCards = (function () {
		var inst = {};
		
		var skillResultTable = (function () {
			var table = createTable( 'id' );
			
			var insert = function ( id, list ) {
				table.insert( { id: id, list: list } );
			};
			/*
SkillResultStage.ATK_DAMAGE_CALCED_A = 'ATK_DAMAGE_CALCED_A';
SkillResultStage.ATK_INC_A = 'ATK_INC_A';
SkillResultStage.ATK_THROW_CARD_A = 'ATK_THROW_CARD_A';
SkillResultStage.DEF_COUNTERATK_A = 'DEF_COUNTERATK_A';
SkillResultStage.DEF_DAMAGE_CALCED_A = 'DEF_DAMAGE_CALCED_A';
SkillResultStage.DEF_INC_A = 'DEF_INC_A';
SkillResultStage.DEF_OVERCOME_CALCED_A = 'DEF_OVERCOME_CALCED_A';
SkillResultStage.MOV_BEFORE_ACT_A = 'MOV_BEFORE_ACT_A';
			*/
			
			/*
SkillResultCalc.VALUE_ADD_001 = 'VALUE_ADD_001'; // v = v + c01
SkillResultCalc.VALUE_ADD_002 = 'VALUE_ADD_002'; // v = v + roundUp( c01 * c02 )
SkillResultCalc.VALUE_CALC_001 = 'VALUE_CALC_001';
SkillResultCalc.VALUE_MINUS_001 = 'VALUE_MINUS_001'; // v = v - c01
SkillResultCalc.VALUE_MULTI_001 = 'VALUE_MULTI_001'; // v = roundDown( v * c01 )
			*/
			
			insert( 'Attack', [
				{stage: SkillResultStage.ATK_INC_A, target: SkillResultTarget.ATK_ATKPOWER, calc: SkillResultCalc.VALUE_ADD_001, varible: ['a']}
			]);
			insert( 'Torpedo', [
				{stage: SkillResultStage.ATK_INC_A, target: SkillResultTarget.ATK_ATKPOWER, calc: SkillResultCalc.VALUE_ADD_001, varible: ['a']},
				{stage: SkillResultStage.ATK_DAMAGE_CALCED_A, target: SkillResultTarget.VARIBLE, calc: SkillResultCalc.VAR_SET_BYATK_DAMAGE_CALCED, varible: SkillVarible.THROW_CARD},
				{stage: SkillResultStage.ATK_THROW_CARD_A, target: SkillResultTarget.DEF_CARDHOLD, calc: SkillResultCalc.CARDHOLD_THROW_001, varible: [SkillVarible.THROW_CARD]}
			]);
			insert( 'Thorn', [
				{stage: SkillResultStage.DEF_INC_A, target: SkillResultTarget.DEF_DEFPOWER, calc: SkillResultCalc.VALUE_ADD_001, varible: ['a']},
				{stage: SkillResultStage.DEF_OVERCOME_CALCED_A, target: SkillResultTarget.VARIBLE, calc: SkillResultCalc.VAR_SET_BYDEF_OVERCOME_CALCED, varible: SkillVarible.COUNTER_ATK},
				{stage: SkillResultStage.DEF_COUNTERATK_A, target: SkillResultTarget.ATK_HP, calc: SkillResultCalc.VALUE_MINUS_001, varible: [SkillVarible.COUNTER_ATK]},
			]);
			insert( 'Tactics', [
				{stage: SkillResultStage.MOV_BEFORE_ACT_A, target: SkillResultTarget.ATK_CARDHOLD, calc: SkillResultCalc.CARDHOLD_ADD_001, varible: ['a']}
			]);
			insert( 'AttackAddSword', [
				{stage: SkillResultStage.ATK_PREPARE_A, target: SkillResultTarget.VARIBLE, calc: SkillResultCalc.VAR_SET_BYATK_SWORD_AMOUNT, varible: SkillVarible.SWORD_AMOUNT},
				{stage: SkillResultStage.ATK_INC_A, target: SkillResultTarget.ATK_ATKPOWER, calc: SkillResultCalc.VALUE_ADD_002, varible: [SkillVarible.SWORD_AMOUNT, 'a']}
			]);
			insert( 'AttackAddHurt', [
				{stage: SkillResultStage.ATK_PREPARE_A, target: SkillResultTarget.VARIBLE, calc: SkillResultCalc.VAR_SET_BYATK_HURT_AMOUNT, varible: SkillVarible.HURT_AMOUNT},
				{stage: SkillResultStage.ATK_INC_A, target: SkillResultTarget.ATK_ATKPOWER, calc: SkillResultCalc.VALUE_ADD_002, varible: [SkillVarible.HURT_AMOUNT, 'a']}
			]);
			
			// to do
			insert( 'HurtLimitHp', [
				{stage: SkillResultStage.DEF_DAMAGE_CALCED_A, target: SkillResultTarget.VARIBLE, calc: SkillResultCalc.VAR_SET_BYDEF_HP, varible: SkillVarible.HURT_LIMIT},
				{stage: SkillResultStage.DEF_DAMAGE_CALCED_B, target: SkillResultTarget.VARIBLE, calc: SkillResultCalc.VALUE_MINUS_001, varible: [SkillVarible.HURT_LIMIT, 'a']},
				{stage: SkillResultStage.DEF_DAMAGE_CALCED_C, target: SkillResultTarget.VARIBLE, calc: SkillResultCalc.VALUE_MINUS_001, varible: [SkillVarible.HURT_LIMIT, 'a']},
			]);
		});
		
		var skillTable = (function () {
			var table = createTable( 'id' );
			
			var insert = function ( id, name, triggerStage, triggerDistance, triggerCards, eventResultId, eventResultValue ) {
				table.insert( { id: id, name: name, triggerStage: triggerStage, triggerDistance: triggerDistance, triggerCards: triggerCards, eventResultId: eventResultId, eventResultValue: eventResultValue } );
			};
			
			// Precise Marksmanship, Torpedo Attack, Thorn Forest, Intelligent Tactics
			// Rapidfire, Supersonic Sword, Adrenalin Attack, Indomitable Spirit
			// Bash, Kill Stance, Blood's Blessing, Spirit Drain
			// Slash, Charged Thrust, Sword Dance, Abandon
			// Shadow Strike, Red Fang, Counter Attack, Backstab
			// Desert Mirage, Thousand Yard Stare, Abyss, Swirling Evil
			// String of Fate, Circle of Fate, Time of Fate, Ghost of Fate
			// Land Mine, Desperado, Shadow Shot, Defense Shot
			// Reject Sword, Counter Guard, Pain Free, Suicide Bombing
			// Flashbang, Sealing Chain, Holy Light, Wave of Healing
			// Suicidal Tendency, Misfit, Big Black, Let's Knife
			// One Heart, Body Double, 9 Spirits, 13 Eyes
			// Wit, Thorn Stance, Sword of Liberation, Cursed Blade
			// Issen, Jissen, Hyakusen, Shura no Kamae
			// Moonshine, Rapture, Doomsday, The Hellbound Heart
			
			insert( 101, 'Precise Marksmanship', SkillTriggerStage.ATK, SkillTriggerDistance.ML,
				[
					{card: ActionCardType.GUN, num: 5, calc: SkillCardCalc.SUM_MIN}
				], 'Attack', { a: 10 }
			);
			insert( 102, 'Torpedo Attack', SkillTriggerStage.ATK, SkillTriggerDistance.S,
				[
					{card: ActionCardType.STAR, num: 2, calc: SkillCardCalc.SUM_MIN},
					{card: ActionCardType.SWORD, num: 4, calc: SkillCardCalc.SUM_MIN}
				], 'Torpedo', { a: 8 }
			);
			insert( 103, 'Thorn Forest', SkillTriggerStage.DEF, SkillTriggerDistance.SM,
				[
					{card: ActionCardType.STAR, num: 3, calc: SkillCardCalc.SUM_MIN},
					{card: ActionCardType.SHIELD, num: 3, calc: SkillCardCalc.SUM_MIN}
				], 'Thorn', { a: 12 }
			);
			insert( 104, 'Intelligent Tactics', SkillTriggerStage.MOV, SkillTriggerDistance.SML,
				[
					{card: ActionCardType.ANY, num: 1, calc: SkillCardCalc.ONE_MIN},
					{card: ActionCardType.ANY, num: 1, calc: SkillCardCalc.ONE_MIN}
				], 'Tactics', { a: 3 }
			);
			insert( 201, 'Rapidfire,', SkillTriggerStage.ATK, SkillTriggerDistance.ML,
				[
					{card: ActionCardType.GUN, num: 3, calc: SkillCardCalc.ONE_EQU},
					{card: ActionCardType.GUN, num: 3, calc: SkillCardCalc.ONE_EQU}
				], 'Attack', { a: 14 }
			);
			insert( 202, 'Supersonic Sword', SkillTriggerStage.ATK, SkillTriggerDistance.ML,
				[
					{card: ActionCardType.SWORD, num: 3, calc: SkillCardCalc.SUM_MIN},
					{card: ActionCardType.GUN, num: 3, calc: SkillCardCalc.SUM_MIN}
				], 'AttackAddSword', { a: 1 }
			);
			insert( 203, 'Adrenalin Attack', SkillTriggerStage.ATK, SkillTriggerDistance.S,
				[
					{card: ActionCardType.STAR, num: 3, calc: SkillCardCalc.SUM_MIN}
				], 'AttackAddHurt', { a: 2 }
			);
			insert( 204, 'Indomitable Spirit', SkillTriggerStage.ATK, SkillTriggerDistance.S,
				[
					{card: ActionCardType.GUN, num: 1, calc: SkillCardCalc.ONE_EQU},
					{card: ActionCardType.GUN, num: 1, calc: SkillCardCalc.ONE_EQU}
				], 'HurtLimitHp', { a: 1 }
			);
			
			log( 'db - skillTable >> ' + table.getSize() );
			return table;
		} ());
		
		var charGroupTable = (function () {
			var table = createTable( 'id' );
			
			var insert = function ( id, name ) {
				table.insert( { id: id, name: name } );
			};
			
			insert(  1, 'Evarist' );
			insert(  2, 'Izac' );
			insert(  3, 'Grunwald' );
			insert(  4, 'Abel' );
			insert(  5, 'Leon' );
			insert(  6, 'Kronig' );
			insert(  7, 'Jead' );
			insert(  8, 'Archibald' );
			insert(  9, 'Max' );
			insert( 10, 'Blaise' );
			insert( 11, 'Sheri' );
			insert( 12, 'Ayn' );
			insert( 13, 'Bernhard' );
			insert( 14, 'Friedrich' );
			insert( 15, 'Marguerite' );
			
			log( 'db - charGroupTable >> ' + table.getSize() );
			return table;
		} ());
		
		var charTable = (function () {
			var table = createTable( 'id' );
			
			var insert = function ( id, gid, level, hp, atk, def, skills ) {
				table.insert( { id: id, gid: gid, level: level, hp: hp, atk: atk, def: def, skills: skills } );
			};
			
			insert(  105,  1, 5, 15, 9, 9, [ 101,  102,  103,  104] );
			insert(  205,  2, 5, 15, 9, 7, [ 201,  202,  203,  204] );
			insert(  305,  3, 5, 13, 11, 9, [ 301,  302,  303,  304] );
			insert(  405,  4, 5, 14, 10, 8, [ 401,  402,  403,  404] );
			insert(  505,  5, 5, 12, 10, 10, [ 501,  502,  503,  504] );
			insert(  605,  6, 5, 12, 7, 11, [ 601,  602,  603,  604] );
			insert(  705,  7, 5, 11, 9, 9, [ 701,  702,  703,  704] );
			insert(  805,  8, 5, 12, 11, 9, [ 801,  802,  803,  804] );
			insert(  905,  9, 5, 12, 11, 8, [ 901,  902,  903,  904] );
			insert( 1005, 10, 5, 12, 9, 9, [1001, 1002, 1003, 1004] );
			insert( 1105, 11, 5, 16, 7, 7, [1101, 1102, 1103, 1104] );
			insert( 1205, 12, 5, 11, 9, 11, [1201, 1202, 1203, 1204] );
			insert( 1305, 13, 5, 13, 9, 10, [1301, 1302, 1303, 1304] );
			insert( 1405, 14, 5, 13, 10, 9, [1401, 1402, 1403, 1404] );
			insert( 1505, 15, 5, 12, 9, 10, [1501, 1502, 1503, 1504] );
			
			log( 'db - charTable >> ' + table.getSize() );
			return table;
		} ());
		
		inst.char = charTable;
		inst.charGroup = charGroupTable;
		inst.skill = skillTable;
		
		return inst;
	} ());
	
	inst.actionCards = actionCards;
	
	return inst;
}());
/*******************************************************************************
 *	Event
 */
/*******************************************************************************
 *	UI
 */
var createUI = function () {
	var inst = {};
	
	var createObj = function ( type, className, text ) {
		var obj = document.createElement( type );
		obj.className = className;
		if ( typeof text !== 'undefined' ) {
			obj.innerHTML = text;
		}
		return obj;
	};
	
	(function init() {
		var divWrapper = createObj( 'div', 'wrapper' );
		document.body.appendChild( divWrapper );
	} ());
	
	return inst;
};
/*******************************************************************************
 *	Model
 */

 // to do
var createFlow = function () {
	var inst = {};
	
	var flowMap = {};
	
	var add = function ( id, proc ) {
		flowMap[id] = proc;
	};
	
	var next = function ( id, code, nextId ) {
	};
	
	inst.add = add;
	inst.next = next;
	
	return inst;
};
/*
var GameStage = {};
GameStage.DEAL = 'DEAL';
GameStage.END = 'END';
GameStage.ERROR = 'ERROR';
GameStage.START = 'START';

var FlowResult = {};
FlowResult.OK = 'OK';
FlowResult.FAIL = 'FAIL';

var flow = (function () {
	var actDeal = function () { log( 'actDeal' ) };
	var actEnd = function () { log( 'actEnd' ) };
	var actError = function () { log( 'actError' ) };
	var actStart = function () { log( 'actStart' ) };
	
	var inst = createFlow();
	inst.add( GameStage.DEAL, actDeal );
	inst.add( GameStage.END, actEnd );
	inst.add( GameStage.ERROR, actError );
	inst.add( GameStage.START, actStart );
	
	inst.next( GameStage.DEAL, FlowResult.FAIL, GameStage.ERROR );
	inst.next( GameStage.END, FlowResult.FAIL, GameStage.ERROR );
	inst.next( GameStage.START, FlowResult.FAIL, GameStage.ERROR );
	
	inst.next( GameStage.START, FlowResult.OK, GameStage.DEAL );
	inst.next( GameStage.DEAL, FlowResult.OK, GameStage.END );
	inst.next( GameStage.END, FlowResult.OK, GameStage.START );
	
	inst.next( GameStage.ERROR, FlowResult.OK, GameStage.END );
	inst.next( GameStage.ERROR, FlowResult.FAIL, GameStage.END );
	
	return inst;
} ());
*/

/*
var DealerStage = {};
DealerStage.START = 'START';
DealerStage.MOVE = 'MOVE';
DealerStage.ATTACK_A = 'ATTACK_A';
DealerStage.ATTACK_B = 'ATTACK_B';
DealerStage.END = 'END';

var createDealerModel = function () {
	var inst = {};
	
	var round = 0;
	var stage = '';
	var cardLeft = null;
	var cardStore = null;
	var cardUsed = null;
	var cardSend = null;
	
	var reset = function () {
		round = 0;
		stage = DealerStage.START;
		cardLeft = [];
		cardStore = [];
		cardUsed = [];
		cardSend = {};
		cardSend.a = [];
		cardSend.b = [];
	};
	
	var setup = function ( actionCardList ) {
		reset();
		round = 1;
		cardLeft = actionCardList;
	};
	
	inst.setup = setup;
	
	return inst;
};
*/

/*
var createPlayerModel = function () {
	var inst = {};
	
	var charCard = null;
	
	return inst;
};

var createFightModel = function () {
	var inst = {};
	
	var dealerModel = createDealerModel();
	var p1Model = createPlayerModel();
	var p2Model = createPlayerModel();
	
	var setup = function ( actionCardList, p1CardList, p2CardList ) {
		dealerModel.setup( actionCardList );
		p1Model.setup( p1CardList );
		p2Model.setup( p2CardList );
	};
	
	inst.setup = setup;
	
	return inst;
};
*/

var GameState = utils.createConst([ 'START', 'MOVE', 'EXCHANGE_A', 'EXCHANGE_B', 'ATTACK_A', 'ATTACK_B', 'DEFENCE_A', 'DEFENCE_B' ]);

var createModel = function () {
	var inst = {};
	
	var data = {};
	
	var dispose = function () {
		inst = null;
		data = null;
	};
	
	var getState = function () { return utils.findElement( data, ['state'], GameState.START ); };
	
	inst.dispose = dispose;
	inst.getState = getState;
	
	return inst;
};
/*******************************************************************************
 *	Controller
 */
var createCtrl = function () {
	var inst = {};
	
	var model = createModel();
	/*
	var playGame = function () {
		model.setNewGame( 1, [105, 205, 305], [405, 505, 605] );
	};
	*/
	var actStart = function () {};
	var actMove = function () {};
	var actExchangeA = function () {};
	var actExchangeB = function () {};
	var actAttackA = function () {};
	var actAttackB = function () {};
	var actDefenceA = function () {};
	var actDefenceB = function () {};
	
	var run = function () {
		var state = model.getState();
		switch( state ) {
		case GameState.START:
			actStart();
			break;
		case GameState.MOVE:
			actMove();
			break;
		case GameState.EXCHANGE_A:
			actExchangeA();
			break;
		case GameState.EXCHANGE_B:
			actExchangeB();
			break;
		case GameState.ATTACK_A:
			actAttackA();
			break;
		case GameState.ATTACK_B:
			actAttackB();
			break;
		case GameState.DEFENCE_A:
			actDefenceA();
			break;
		case GameState.DEFENCE_B:
			actDefenceB();
			break;
		}
	};
	
	inst.run = run;
	
	return inst;
};
/*******************************************************************************
 *	Main
 */
var main = (function () {
	log( 'init start' );
	var ui = createUI();
	log( 'init UI ready' );
	var ctrl = createCtrl();
	log( 'init Controller ready' );
	
	log( 'init ready' );
	
	ctrl.run();
}());
</script>
</html>