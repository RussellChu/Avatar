<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title></title>
<style>
.abc:hover {
	background-color: #086912;
}
.abc {
	background-attachment: scroll;
	background-clip: border-box;
	background-color: rgb(51, 172, 63);
	background-image: none;
	background-origin: padding-box;
	background-position-x: 0%;
	background-position-y: 0%;
	background-repeat-x: initial;
	background-repeat-y: initial;
	background-size: auto;
	border-bottom-color: rgb(255, 255, 255);
	border-bottom-left-radius: 3px;
	border-bottom-right-radius: 3px;
	border-bottom-style: none;
	border-bottom-width: 0px;
	border-image-outset: 0px;
	border-image-repeat: stretch;
	border-image-slice: 100%;
	border-image-source: none;
	border-image-width: 1;
	border-left-color: rgb(255, 255, 255);
	border-left-style: none;
	border-left-width: 0px;
	border-right-color: rgb(255, 255, 255);
	border-right-style: none;
	border-right-width: 0px;
	border-top-color: rgb(255, 255, 255);
	border-top-left-radius: 3px;
	border-top-right-radius: 3px;
	border-top-style: none;
	border-top-width: 0px;
	box-sizing: border-box;
	color: rgb(255, 255, 255);
	cursor: default;
	display: inline-block;
	font-family: Arial;
	font-size: 15px;
	font-stretch: normal;
	font-style: normal;
	font-variant-caps: normal;
	font-variant-ligatures: normal;
	font-variant-numeric: normal;
	font-weight: normal;
	height: 33px;
	letter-spacing: normal;
	line-height: normal;
	margin-bottom: 0px;
	margin-left: 0px;
	margin-right: 0px;
	margin-top: 0px;
	outline-color: rgb(255, 255, 255);
	outline-style: none;
	outline-width: 0px;
	padding-bottom: 8px;
	padding-left: 20px;
	padding-right: 20px;
	padding-top: 8px;
	text-align: center;
	text-indent: 0px;
	text-rendering: auto;
	text-shadow: none;
	text-transform: none;
	user-select: none;
	white-space: pre;
	width: 87px;
	word-spacing: 0px;
	writing-mode: horizontal-tb;
	-webkit-appearance: none;
	-webkit-rtl-ordering: logical;
	-webkit-border-image: none;
}
</style>
</head>
<body style="margin:0;">
<div id="assets">
<div id="btn">
<!--
<input type="button" value="Search A" class="abc"><input type="button" value="Search" id="btnSearch" class="abc">
-->
</div>
</div>
</body>
<!--

-->
<script src="./lib/core.js"></script>
<script>


////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////
////////////////////////////////////////
////////////////////
//	API
////////////////////
////////////////////////////////////////
////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

var tools = (function () {
	var instance = {};
	
	var log = function () {
		var str = "";
		for(var i = 0; i < arguments.length; i++) {
			if ( i > 0 ) {
				str += " ";
			}
			str += arguments[i];
		}
		console.log( str );
	};
	
	var setter = {};
	
	var isValidInt = function ( value ) {
		if ( value !== parseInt( value ) ) {
			return false;
		}
		if ( value === NaN || value === Infinity || value === -Infinity ) {
			return false;
		}
		return true;
	};
	
	var isValidNum = function ( value ) {
		if ( typeof value !== 'number' ) {
			return false;
		}
		if ( value === NaN || value === Infinity || value === -Infinity ) {
			return false;
		}
		return true;
	};
	
	var isValidStr = function ( value ) {
		if ( typeof value !== 'string' ) {
			return false;
		}
		return true;
	};
	
	var isValidObj = function ( value ) {
		if ( typeof value !== 'object' ) {
			return false;
		}
		return ( value !== null );
	};
	
	var isValidFunc = function ( value ) {
		return ( typeof value === 'function' );
	};
	
	var hasValidFunc = function ( obj, key ) {
		if ( !isValidObj( obj ) ) {
			return false;
		}
		if ( typeof obj[key] !== 'function' ) {
			return false;
		}
		return true;
	};
	
	var hasValidNum = function ( obj, key ) {
		if ( !isValidObj( obj ) ) {
			return false;
		}
		if ( typeof obj[key] !== 'number' ) {
			return false;
		}
		var value = obj[key];
		if ( value === NaN || value === Infinity || value === -Infinity ) {
			return false;
		}
		return true;
	};
	
	var hasValidStr = function ( obj, key ) {
		if ( !isValidObj( obj ) ) {
			return false;
		}
		if ( typeof obj[key] !== 'string' ) {
			return false;
		}
		return true;
	};
	
	var toInt = function ( p_value ) {
		var value = parseInt( p_value );
		if ( value === NaN || value === Infinity || value === -Infinity ) {
			return 0;
		}
		return value;
	};
	
	var toNum = function ( p_value ) {
		var value = Number( p_value );
		if ( value === NaN || value === Infinity || value === -Infinity ) {
			return 0;
		}
		return value;
	};
	
	var toStr = function ( value ) {
		if ( typeof value === 'string' ) {
			return value;
		}
		if ( typeof value === 'number' ) {
			return String( value );
		}
		if ( typeof value === 'boolean' ) {
			return String( value );
		}
		return '';
	};
	
	var setBool = function ( value, defaultValue ) {
		if ( typeof value === 'boolean' ) {
			return value;
		}
		if ( typeof defaultValue === 'boolean' ) {
			return defaultValue;
		}
		return false;
	};
	
	var setStr = function ( value, defaultValue ) {
		if ( typeof value === 'string' ) {
			return value;
		}
		if ( typeof value === 'number' ) {
			return String( value );
		}
		if ( typeof value === 'boolean' ) {
			return String( value );
		}
		return toStr( defaultValue );
	};
	
	var setNum = function ( value, defaultValue, option ) {
		var rslt = 0;
		if ( isValidNum( value ) ) {
			rslt = value;
		} else {
			rslt = toNum( defaultValue );
		}
		if ( isValidObj( option ) ) {
			if ( hasValidNum( option, 'min' ) ) {
				var min = option.min;
				if ( rslt < min )
				{
					rslt = min;
				}
			}
			if ( hasValidNum( option, 'max' ) ) {
				var max = option.max;
				if ( rslt > max )
				{
					rslt = max;
				}
			}
		}
		return rslt;
	};
	
	var setInt = function ( value, defaultValue, option ) {
		var rslt = 0;
		if ( isValidNum( value ) ) {
			rslt = toInt( value );
		} else {
			rslt = toInt( defaultValue );
		}
		if ( isValidObj( option ) ) {
			if ( hasValidNum( option, 'min' ) ) {
				var min = toInt( option.min );
				if ( rslt < min )
				{
					rslt = min;
				}
			}
			if ( hasValidNum( option, 'max' ) ) {
				var max = toInt( option.max );
				if ( rslt > max )
				{
					rslt = max;
				}
			}
		}
		return rslt;
	};
	
	setter.isValidInt = isValidInt;
	setter.isValidNum = isValidNum;
	setter.isValidStr = isValidStr;
	setter.isValidObj = isValidObj;
	setter.isValidFunc = isValidFunc;
	setter.hasValidFunc = hasValidFunc;
	setter.hasValidNum = hasValidNum;
	setter.hasValidStr = hasValidStr;
	setter.toInt = toInt;
	setter.toNum = toNum;
	setter.toStr = toStr;
	setter.setBool = setBool;
	setter.setStr = setStr;
	setter.setNum = setNum;
	setter.setInt = setInt;
	
	// key of Array always string
	var isExist = function ( obj ) {
		if ( typeof obj === 'undefined' ) {
			return false;
		}
		if ( typeof obj === 'number' ) {
			if ( obj === NaN || obj === Infinity || obj === -Infinity ) {
				return false;
			}
			return true;
		}
		if ( typeof obj === 'string' ) {
			if ( obj === '' ) {
				return false;
			}
			return true;
		}
		if ( typeof obj === 'object' ) {
			if ( obj === null ) {
				return false;
			}
			return true;
		}
		return true;
	};
	
	var ifExistDo = function ( obj, key, func, defaultValue ) {
		var result;
		if ( isExist( defaultValue ) ) {
			result = defaultValue;
		} else {
			result = false;
		}
		if ( !isValidObj( obj ) ) {
			return result;
		}
		if ( typeof key === 'undefined' ) {
			return result;
		}
		if ( typeof func !== 'function' ) {
			return result;
		}
		if ( !isExist( obj[key] ) ) {
			return result;
		}
		return func( obj[key] );
	};
	
	var getChildById = function ( inst, id ) {
		if ( !isExist( inst ) ) {
			return null;
		}
		if ( !isExist( id ) ) {
			return null;
		}
		for(var i = 0; i < inst.childNodes.length; i++) {
			var item = inst.childNodes[i];
			if ( item.id === id ) {
				return item;
			}
		}
		return null;
	};
	
	var buildClass = function ( setting ) {
		if ( !isValidObj( setting ) ) {
			return function () {};
		}
		
		var TAG = setStr( setting['TAG'], 'Unknown' );
		
		var superClass;
		if ( typeof setting.superClass === 'function' ) {
			superClass = setting.superClass;
		}
		
		var constructor;
		if ( typeof setting.constructor === 'function' ) {
			constructor = setting.constructor;
		} else {
			constructor = function () {};
		}
		
		var __static__ = setting.__static__;
		
		var hasProp = {}.hasOwnProperty;
		
		var newClass;
		
		eval( "newClass = function " + TAG + "() { constructor.apply( this, arguments ); };" );
		
		newClass.__tag__ = TAG;
		newClass.__tags__ = {};
		newClass.__tags__[TAG] = true;
		
		// inherit super class
		if ( typeof superClass === 'function' ) {
			// set static param / method
			for (var key in superClass) {
				if ( key === '__tag__' ) {
					continue;
				}
				if ( key === '__tags__' ) {
					continue;
				}
				if ( hasProp.call( superClass, key )) {
					newClass[key] = superClass[key];
				}
			}
			
			for (var key in superClass.__tags__) {
				newClass.__tags__[key] = true;
			}
			
			newClass.__super__ = superClass.prototype;
			newClass.prototype = {};
			
			// set dynamic param / method
			for (var key in superClass.prototype) {
			//	if ( hasProp.call( superClass.prototype, key )) {
					newClass.prototype[key] = superClass.prototype[key];
			//	}
			}
		}
		
		delete setting['TAG'];
		delete setting['__static__'];
		delete setting['constructor'];
		delete setting['superClass'];
		delete setting['err'];
		delete setting['log'];
		delete setting['getTag'];
		delete setting['hasTagOfClass'];
		
		for (var key in setting) {
			newClass.prototype[key] = setting[key];
		}
		
		newClass.prototype.constructor = constructor;
		
		newClass.prototype.err = function () {
			var str = "";
			for(var i = 0; i < arguments.length; i++) {
				if ( i > 0 ) {
					str += " ";
				}
				str += arguments[i];
			}
			log( '[ERROR]', '[' + TAG + ']', str );
		};
		
		newClass.prototype.log = function () {
			var str = "";
			for(var i = 0; i < arguments.length; i++) {
				if ( i > 0 ) {
					str += " ";
				}
				str += arguments[i];
			}
			log( '[LOG]', '[' + TAG + ']', str );
		};
		
		newClass.prototype.getTag = function () {
			return newClass.__tag__;
		};
		
		newClass.prototype.hasTagOfClass = function ( value ) {
			if ( !( typeof value === 'function' ) ) {
				return false;
			}
			if ( !( typeof value.__tag__ === 'string' ) ) {
				return false;
			}
			
			var tag = value.__tag__;
			for (var key in newClass.__tags__) {
				if ( key === tag ) {
					return true;
				}
			}
			
			return false;
		};
		
		if ( isValidObj( __static__ ) ) {
			for (var key in __static__) {
				newClass[key] = __static__[key];
				/*
				Object.defineProperty( newClass, key, {
					value: constant[key],
					writable: false,
					enumerable: true,
					configurable: true
				});
				*/
			}
		}
		
		newClass.isCreatorOf = function ( obj ) {
			if ( !setter.hasValidFunc( obj, 'hasTagOfClass' ) ) {
				return false;
			}
			return obj.hasTagOfClass( newClass );
		};
		
		return newClass;
	};
	
	var looper = {};
	
	looper.pairs = function ( list, func ) {
		if ( !( list instanceof Array ) ) {
			return;
		}
		if ( list === null ) {
			return;
		}
		if ( !setter.isValidFunc( func ) ) {
			return;
		}
		for(var i = 0; i < list.length - 1; i++) {
			if ( !setter.isValidObj( list[i] ) ) {
				continue;
			}
			for(var j = i + 1; j < list.length; j++) {
				if ( !setter.isValidObj( list[j] ) ) {
					continue;
				}
				func( list[i], list[j] );
			}
		}
	};
	
	instance.buildClass = buildClass;
	instance.ifExistDo = ifExistDo;
	instance.isExist = isExist;
	instance.looper = looper;
	instance.setter = setter;
	instance.getChildById = getChildById;
	instance.log = log;
	return instance;
} ());

var buildClass = tools.buildClass;
var ifExistDo = tools.ifExistDo;
var isExist = tools.isExist;
var looper = tools.looper;
var setter = tools.setter;
var getChildById = tools.getChildById;
var log = tools.log;

var TimeCore = (function () {
	var inst = {};
	var currTime = 0;
	var delayList = [{}];
	var timeSlot = {};
	
	var updateCurrTime = function () {
		var d = new Date();
		currTime = d.getTime();
	};
	
	updateCurrTime();
	
	var handler;
	handler = function () {
		var lastTime = currTime;
		updateCurrTime();
		for(var i = lastTime + 1; i <= currTime; i++) {
			var nextSlot = timeSlot[i];
			if ( !setter.isValidObj( nextSlot ) ) {
				continue;
			}
			for(var j = 0; j < nextSlot.length; j++) {
				if ( setter.isValidFunc( nextSlot[j] ) ) {
					nextSlot[j]();
					delete nextSlot[j];
				}
			}
			delete timeSlot[i];
		}
		setTimeout( handler, 1 );
	};
	
	var delay = function ( callBack, p_interval ) {
		if ( !setter.isValidFunc( callBack ) ) {
			return 0;
		}
		
		var interval = setter.setInt( p_interval, 0 );
		
		if ( interval < 1 ) {
			return 0;
		}
		
		var nextTime = Math.floor(currTime + interval);
		var nextSlot = timeSlot[nextTime];
		if ( !setter.isValidObj( nextSlot ) ) {
			nextSlot = [];
			timeSlot[nextTime] = nextSlot;
		}
		
		var delayId = delayList.length;
		delayList.push( { slot: nextTime, idx: nextSlot.length } );
		
		nextSlot.push( callBack );
		
		return delayId;
	};
	
	var killDelay = function ( delayId ) {
		if ( !setter.isValidInt( delayId ) ) {
			return;
		}
		if ( delayId <= 0 ) {
			return;
		}
		if ( setter.isValidObj( delayList[delayId] ) ) {
			var slot = delayList[delayId].slot;
			var idx = delayList[delayId].idx;
			delete delayList[delayId];
			
			var nextSlot = timeSlot[slot];
			if ( setter.isValidObj( nextSlot ) ) {
				nextSlot[idx] = null;
			}
		}
	}
	
	var Timer = buildClass({
		  TAG: 'Timer'
		, _callBack: null
		, _delayId: 0
		, _init: false
		, _minItvl: 0
		, _run: false
		, _stdItvl: 0
		, _t: 0
		, _t0: 0
		, constructor: function ( callBack, p_stdItvl, p_minItvl ) {
			if ( !setter.isValidFunc( callBack ) ) {
				return 0;
			}
			
			var stdItvl = setter.setInt( p_stdItvl, 0 );
			if ( stdItvl < 1 ) {
				return;
			}
			
			this._stdItvl = stdItvl;
			this._minItvl = setter.setInt( p_minItvl, stdItvl * 0.5, { min: 1 } );
			
			this._callBack = callBack;
			this._t = currTime - this._stdItvl;
			this._t0 = this._t;
			this._init = true;
		}
		, dispose: function () {
			this.stop();
			
			this._init = false;
			
			this._callBack = null;
		}
		, process: function () {
			if ( !this._run ) {
				return;
			}
			
			var t2 = this._t;
			this._t = currTime;
			var diff2 = this._t - this._t0;
			this._t0 = this._t;
			var diff = this._stdItvl + t2 - this._t;
			if ( diff < this._minItvl - this._stdItvl ) {
				diff = this._minItvl - this._stdItvl;
			}
			
			this._t += diff;
			
			if ( this._callBack.length === 1 ) {
				this._callBack( diff2 );
			}
			else {
				this._callBack();
			}
			
			var self = this;
			var selfArgs = arguments;
			this._delayId = delay( function () {
				self.process.apply( self, selfArgs );
			}, diff + this._stdItvl );
		}
		, run: function () {
			if ( !this._init ) {
				return;
			}
			
			if ( this._run ) {
				return;
			}
			
			this._run = true;
			
			var self = this;
			var selfArgs = arguments;
			this._delayId = delay( function () {
				self.process.apply( self, selfArgs );
			}, 1 );
		}
		, stop: function () {
			this._run = false;
			
			killDelay( this._delayId );
			this._delayId = 0;
		}
		, running: function () {
			return this._run;
		}
	});
	
	var timer = function ( callBack, stdItvl, minItvl ) {
		var inst = new Timer( callBack, stdItvl, minItvl );
		return inst;
	};
	
	inst.delay = delay;
	inst.timer = timer;
	inst.time = function () {
		return currTime;
	}
	
	setTimeout( handler, 1 );
	
	return inst;
} ());

var Signal = buildClass({
	  TAG: 'Signal'
	, _list: null
	, constructor: function () {
		this.init();
	}
	, init: function () {
		this._list = [];
	}
	, dispose: function () {
		this._list = null;
	}
	, add: function ( func ) {
		if ( !setter.isValidFunc( func ) ) {
			return;
		}
		this._list.push( func );
	}
	, dispatch: function ( data ) {
		for(var i = 0; i < this._list.length; i++) {
			this._list[i]( data );
		}
	}
});

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////
////////////////////////////////////////
////////////////////
//	CMath
////////////////////
////////////////////////////////////////
////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

var CMath = (function () {
	var inst = {};
	
	var Vec2 = buildClass({
		  TAG: 'Vec2'
		, __static__: {
			  createFromObj: function ( value ) {
				var rslt = new Vec2();
				if ( !setter.isValidObj( value ) ) {
					return rslt;
				}
				rslt.x = setter.setNum( value.x, 0 );
				rslt.y = setter.setNum( value.y, 0 );
				return rslt;
			}
		}
		, x: 0
		, y: 0
		, constructor: function ( x, y ) {
			this.x = setter.setNum( x, 0 );
			this.y = setter.setNum( y, 0 );
		}
		, clone: function () {
			return new Vec2( this.x, this.y );
		}
		, convertToObj: function () {
			return { x: this.x, y: this.y };
		}
		, addEql: function ( value ) {
			if ( value.hasTagOfClass( Vec2 ) ) {
				this.x += value.x;
				this.y += value.y;
			} else {
				this.err( 'addEql fail' );
			}
			return this;
		}
		, minusEql: function ( value ) {
			if ( value.hasTagOfClass( Vec2 ) ) {
				this.x -= value.x;
				this.y -= value.y;
			} else {
				this.err( 'minus fail' );
			}
			return this;
		}
		, mulEql: function ( value ) {
			if ( setter.isValidNum( value ) ) {
				this.x *= value;
				this.y *= value;
			} else {
				this.err( 'mulEql fail' );
			}
			return this;
		}
		, divEql: function ( value ) {
			if ( setter.isValidNum( value ) && value !== 0 ) {
				var inv = 1 / value;
				this.x *= inv;
				this.y *= inv;
			} else {
				this.err( 'divEql fail' );
			}
			return this;
		}
		, add: function ( value ) {
			var rslt = this.clone();
			if ( value.hasTagOfClass( Vec2 ) ) {
				rslt.x += value.x;
				rslt.y += value.y;
			} else {
				this.err( 'add fail' );
			}
			return rslt;
		}
		, minus: function ( value ) {
			var rslt = this.clone();
			if ( value.hasTagOfClass( Vec2 ) ) {
				rslt.x -= value.x;
				rslt.y -= value.y;
			} else {
				this.err( 'minus fail' );
			}
			return rslt;
		}
		, mul: function ( value ) {
			var rslt = this.clone();
			if ( setter.isValidNum( value ) ) {
				rslt.x *= value;
				rslt.y *= value;
			} else {
				this.err( 'mul fail' );
			}
			return rslt;
		}
		, div: function ( value ) {
			var rslt = this.clone();
			if ( setter.isValidNum( value ) && value !== 0 ) {
				var inv = 1 / value;
				rslt.x *= inv;
				rslt.y *= inv;
			} else {
				this.err( 'div fail' );
			}
			return rslt;
		}
		, magSqr: function () {
			return this.x * this.x + this.y * this.y;
		}
		, mag: function () {
			return Math.sqrt( this.magSqr() );
		}
		, normalize: function () {
			if ( this.x !== 0 || this.y !== 0 ) {
				var magInv = 1 / this.mag();
				return this.mulEql( magInv );
			}
			return this;
		}
		, dot: function ( value ) {
			return this.x * value.x + this.y * value.y;
		}
	});

	var Vec3 = buildClass({
		  TAG: 'Vec3'
		, x: 0
		, y: 0
		, z: 0
		, __static__: {
			  createFromObj: function ( value ) {
				var rslt = new Vec3();
				if ( !setter.isValidObj( value ) ) {
					return rslt;
				}
				rslt.x = setter.setNum( value.x, 0 );
				rslt.y = setter.setNum( value.y, 0 );
				rslt.z = setter.setNum( value.z, 0 );
				return rslt;
			}
		}
		, constructor: function ( x, y, z ) {
			this.x = setter.setNum( x, 0 );
			this.y = setter.setNum( y, 0 );
			this.z = setter.setNum( z, 0 );
		}
		, clone: function () {
			return new Vec3( this.x, this.y, this.z );
		}
		, convertToObj: function () {
			return { x: this.x, y: this.y, z: this.z };
		}
		, addEql: function ( value ) {
			if ( value.hasTagOfClass( Vec3 ) ) {
				this.x += value.x;
				this.y += value.y;
				this.z += value.z;
			} else {
				this.err( 'addEql fail' );
			}
			return this;
		}
		, minusEql: function ( value ) {
			if ( value.hasTagOfClass( Vec3 ) ) {
				this.x -= value.x;
				this.y -= value.y;
				this.z -= value.z;
			} else {
				this.err( 'minus fail' );
			}
			return this;
		}
		, mulEql: function ( value ) {
			if ( setter.isValidNum( value ) ) {
				this.x *= value;
				this.y *= value;
				this.z *= value;
			} else {
				this.err( 'mulEql fail' );
			}
			return this;
		}
		, divEql: function ( value ) {
			if ( setter.isValidNum( value ) && value !== 0 ) {
				var inv = 1 / value;
				this.x *= inv;
				this.y *= inv;
				this.z *= inv;
			} else {
				this.err( 'divEql fail' );
			}
			return this;
		}
		, add: function ( value ) {
			var rslt = this.clone();
			if ( value.hasTagOfClass( Vec3 ) ) {
				rslt.x += value.x;
				rslt.y += value.y;
				rslt.z += value.z;
			} else {
				this.err( 'add fail' );
			}
			return rslt;
		}
		, minus: function ( value ) {
			var rslt = this.clone();
			if ( value.hasTagOfClass( Vec3 ) ) {
				rslt.x -= value.x;
				rslt.y -= value.y;
				rslt.z -= value.z;
			} else {
				this.err( 'minus fail' );
			}
			return rslt;
		}
		, mul: function ( value ) {
			var rslt = this.clone();
			if ( setter.isValidNum( value ) ) {
				rslt.x *= value;
				rslt.y *= value;
				rslt.z *= value;
			} else {
				this.err( 'mul fail' );
			}
			return rslt;
		}
		, div: function ( value ) {
			var rslt = this.clone();
			if ( setter.isValidNum( value ) && value !== 0 ) {
				var inv = 1 / value;
				rslt.x *= inv;
				rslt.y *= inv;
				rslt.z *= inv;
			} else {
				this.err( 'div fail' );
			}
			return rslt;
		}
		, magSqr: function () {
			return this.x * this.x + this.y * this.y + this.z * this.z;
		}
		, mag: function () {
			return Math.sqrt( this.magSqr() );
		}
		, normalize: function () {
			if ( this.x !== 0 || this.y !== 0 || this.z !== 0 ) {
				var magInv = 1 / this.mag();
				return this.mulEql( magInv );
			}
			return this;
		}
	});
	
	inst.Vec2 = Vec2;
	inst.Vec3 = Vec3;
	
	return inst;
} ());
var Vec2 = CMath.Vec2;
var Vec3 = CMath.Vec3;

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////
////////////////////////////////////////
////////////////////
//	Model
////////////////////
////////////////////////////////////////
////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

var Plane2D = buildClass({
	  TAG: 'Plane2D'
	, _pos: null
	, _dir: null
	, _shape: ''
	, constructor: function () {
		this.init();
	}
	, init: function () {
		this._pos = new Vec2();
		this._dir = new Vec2( 1, 0 );
	}
	, dispose: function () {
		this._pos = null;
		this._dir = null;
	}
	, clone: function () {
		var obj = new Plane2D();
		obj._pos = this._pos.clone();
		obj._dir = this._dir.clone();
		return obj;
	}
	, getDir: function () {
		return this._dir.clone();
	}
	, setDir: function ( value ) {
		this._dir = Vec2.createFromObj( value );
	}
	, getPos: function () {
		return this._pos.clone();
	}
	, setPos: function ( value ) {
		this._pos = Vec2.createFromObj( value );
	}
	, getShape: function () {
		return this._shape;
	}
	, isOverlap: function ( target ) {
		return Plane2DOverlapChecker.calc( this, target );
	}
});

var Plane2D_Wall = buildClass({
	  TAG: 'Plane2D_Wall'
	, superClass: Plane2D
	, __static__: {
		  SHAPE: 'Plane2D_Wall'
	}
	, constructor: function () {
		Plane2D_Wall.__super__.constructor.apply( this, arguments );
	}
	, init: function () {
		Plane2D_Wall.__super__.init.apply( this, arguments );
		this._shape = Plane2D_Wall.SHAPE;
	}
	, dispose: function () {
		Plane2D_Wall.__super__.dispose.apply( this, arguments );
	}
	, clone: function () {
		var obj = new Plane2D_Wall();
		obj._pos = this._pos.clone();
		obj._dir = this._dir.clone();
		return obj;
	}
});

var Plane2D_Circle = buildClass({
	  TAG: 'Plane2D_Circle'
	, superClass: Plane2D
	, __static__: {
		  SHAPE: 'Plane2D_Circle'
	}
	, _radius: 0
	, constructor: function ( radius ) {
		this._radius = setter.setNum( radius, 0, { min: 0 } );
		
		Plane2D_Circle.__super__.constructor.apply( this, arguments );
	}
	, init: function () {
		Plane2D_Circle.__super__.init.apply( this, arguments );
		this._shape = Plane2D_Circle.SHAPE;
	}
	, dispose: function () {
		Plane2D_Circle.__super__.dispose.apply( this, arguments );
	}
	, clone: function () {
		var obj = new Plane2D_Circle();
		obj._pos = this._pos.clone();
		obj._dir = this._dir.clone();
		obj._radius = this._radius;
		return obj;
	}
	, getRadius: function () {
		return this._radius;
	}
});

var Plane2D_Rect = buildClass({
	  TAG: 'Plane2D_Rect'
	, superClass: Plane2D
	, __static__: {
		  SHAPE: 'Plane2D_Rect'
	}
	, _cornerX: 0
	, _cornerY: 0
	, _width: 0
	, _height: 0
	, constructor: function ( width, height, cornerX, cornerY ) {
		this._cornerX = setter.setNum( cornerX, 0 );
		this._cornerY = setter.setNum( cornerY, 0 );
		this._width = setter.setNum( width, 0, { min: 0 } );
		this._height = setter.setNum( height, 0, { min: 0 } );
		
		Plane2D_Rect.__super__.constructor.apply( this, arguments );
	}
	, init: function () {
		Plane2D_Rect.__super__.init.apply( this, arguments );
		this._shape = Plane2D_Rect.SHAPE;
	}
	, dispose: function () {
		Plane2D_Rect.__super__.dispose.apply( this, arguments );
	}
	, clone: function () {
		var obj = new Plane2D_Rect();
		obj._pos = this._pos.clone();
		obj._dir = this._dir.clone();
		obj._cornerX = this._cornerX;
		obj._cornerY = this._cornerY;
		obj._width = this._width;
		obj._height = this._height;
		return obj;
	}
	, getCorner: function () {
		return new Vec2( this._cornerX, this._cornerY );
	}
	, getSize: function () {
		return new Vec2( this._width, this._height );
	}
});

Plane2DOverlapChecker = (function () {
	var inst = {};
	
	var calcPointVsWall = function ( objPt, objWall ) {
		if ( objWall._pos.minus( objPt._pos ).dot( objWall._dir ) > 0 ) {
			return true;
		}
		return false;
	};
	var calcPointVsCircle = function ( objPt, objCir ) {
		if ( objPt._pos.minus( objCir._pos ).mag() < objCir._radius ) {
			return true;
		}
		return false;
	};
	var calcPointVsRect = function ( objPt, objRec ) {
		if ( objPt._pos.x < objRec._pos.x + objRec._cornerX ) {
			return false;
		}
		if ( objPt._pos.x > objRec._pos.x + objRec._cornerX + objRec._width ) {
			return false;
		}
		if ( objPt._pos.y < objRec._pos.y + objRec._cornerY ) {
			return false;
		}
		if ( objPt._pos.y > objRec._pos.y + objRec._cornerY + objRec._height ) {
			return false;
		}
		return true;
	};
	var calcWallVsCircle = function ( objWall, objCir ) {
		if ( objWall._pos.minus( objCir._pos ).dot( objWall._dir ) > -objCir._radius ) {
			return true;
		}
		return false;
	};
	var calcWallVsRect = function ( objWall, objRec ) {
		if ( objWall._pos.minus( new Vec2( objRec._pos.x + objRec._cornerX, objRec._pos.y + objRec._cornerY ) ).dot( objWall._dir ) > 0 ) {
			return true;
		}
		if ( objWall._pos.minus( new Vec2( objRec._pos.x + objRec._cornerX, objRec._pos.y + objRec._cornerY + objRec._height ) ).dot( objWall._dir ) > 0 ) {
			return true;
		}
		if ( objWall._pos.minus( new Vec2( objRec._pos.x + objRec._cornerX + objRec._width, objRec._pos.y + objRec._cornerY ) ).dot( objWall._dir ) > 0 ) {
			return true;
		}
		if ( objWall._pos.minus( new Vec2( objRec._pos.x + objRec._cornerX + objRec._width, objRec._pos.y + objRec._cornerY + objRec._height ) ).dot( objWall._dir ) > 0 ) {
			return true;
		}
		return false;
	};
	var calcCircleVsCircle = function ( objCir0, objCir1 ) {
		if ( objCir0._pos.minus( objCir1._pos ).mag() < objCir0._radius + objCir1._radius ) {
			return true;
		}
		return false;
	};
	var calcCircleVsRect = function ( objCir, objRec ) {
		var rslt = true;
		if ( objCir._pos.x + objCir._radius < objRec._pos.x + objRec._cornerX ) {
			rslt = false;
		} else if ( objCir._pos.x - objCir._radius > objRec._pos.x + objRec._cornerX + objRec._width ) {
			rslt = false;
		} else if ( objCir._pos.y < objRec._pos.y + objRec._cornerY ) {
			rslt = false;
		} else if ( objCir._pos.y > objRec._pos.y + objRec._cornerY + objRec._height ) {
			rslt = false;
		}
		if ( rslt ) {
			return true;
		}
		
		var rslt = true;
		if ( objCir._pos.x < objRec._pos.x + objRec._cornerX ) {
			rslt = false;
		} else if ( objCir._pos.x > objRec._pos.x + objRec._cornerX + objRec._width ) {
			rslt = false;
		} else if ( objCir._pos.y + objCir._radius < objRec._pos.y + objRec._cornerY ) {
			rslt = false;
		} else if ( objCir._pos.y - objCir._radius > objRec._pos.y + objRec._cornerY + objRec._height ) {
			rslt = false;
		}
		if ( rslt ) {
			return true;
		}
		
		if ( objCir._pos.minus( new Vec2( objRec._pos.x + objRec._cornerX, objRec._pos.y + objRec._cornerY ) ).mag() < objCir._radius ) {
			return true;
		}
		if ( objCir._pos.minus( new Vec2( objRec._pos.x + objRec._cornerX, objRec._pos.y + objRec._cornerY + objRec._height ) ).mag() < objCir._radius ) {
			return true;
		}
		if ( objCir._pos.minus( new Vec2( objRec._pos.x + objRec._cornerX + objRec._width, objRec._pos.y + objRec._cornerY ) ).mag() < objCir._radius ) {
			return true;
		}
		if ( objCir._pos.minus( new Vec2( objRec._pos.x + objRec._cornerX + objRec._width, objRec._pos.y + objRec._cornerY + objRec._height ) ).mag() < objCir._radius ) {
			return true;
		}
		
		return false;
	};
	var calcRectVsRect = function ( objRec0, objRec1 ) {
		if ( objRec0._pos.x + objRec0._cornerX + objRec0._width < objRec1._pos.x + objRec1._cornerX ) {
			return false;
		}
		if ( objRec0._pos.x + objRec0._cornerX > objRec1._pos.x + objRec1._cornerX + objRec1._width ) {
			return false;
		}
		if ( objRec0._pos.y + objRec0._cornerY + objRec0._height < objRec1._pos.y + objRec1._cornerY ) {
			return false;
		}
		if ( objRec0._pos.y + objRec0._cornerY > objRec1._pos.y + objRec1._cornerY + objRec1._height ) {
			return false;
		}
		return true;
	};
	
	var map = {};
	
	map['Plane2D'] = {};
	map['Plane2D_Wall'] = {};
	map['Plane2D_Circle'] = {};
	map['Plane2D_Rect'] = {};
	
	map['Plane2D']['Plane2D_Wall'] = calcPointVsWall;
	map['Plane2D']['Plane2D_Circle'] = calcPointVsCircle;
	map['Plane2D']['Plane2D_Rect'] = calcPointVsCircle;
	map['Plane2D_Wall']['Plane2D_Circle'] = calcWallVsCircle;
	map['Plane2D_Wall']['Plane2D_Rect'] = calcWallVsRect;
	map['Plane2D_Circle']['Plane2D_Circle'] = calcCircleVsCircle;
	map['Plane2D_Circle']['Plane2D_Rect'] = calcCircleVsRect;
	map['Plane2D_Rect']['Plane2D_Rect'] = calcRectVsRect;
	
	var calc = function ( obj0, obj1 ) {
		var tag0 = obj0.getTag();
		var tag1 = obj1.getTag();
		var pre = null;
		var func;
		
		pre = map[tag0];
		if ( pre ) {
			func = pre[tag1];
			if ( func ) {
				return func( obj0, obj1 );
			}
		}
		
		pre = map[tag1];
		if ( pre ) {
			func = pre[tag0];
			if ( func ) {
				return func( obj1, obj0 );
			}
		}
		
		return false;
	};
	
	inst.calc = calc;
	return inst;
} ());

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////
////////////////////////////////////////
////////////////////
//	UI
////////////////////
////////////////////////////////////////
////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

var GlobalSignal = (function () {
	var instance = {};
	
	var mouseMove = new Signal();
	var mouseUp = new Signal();
	
	document.body.onmousemove = function ( e ) {
		mouseMove.dispatch( e );
	};
	
	document.body.onmouseup = function ( e ) {
		mouseUp.dispatch( e );
	};
	
	instance.mouseMove = mouseMove;
	instance.mouseUp = mouseUp;
	
	return instance;
} ());

var DisplayObject = buildClass({
	  TAG: 'DisplayObject'
	, __static__: {
		  ACTION_NULL: 'DisplayObject.ACTION_NULL'
		, ACTION_SENSOR_UPDATE: 'DisplayObject.ACTION_SENSOR_UPDATE'
	}
	, _inst: null
	, _type: ''
	, _data: null
	, _parent: null
	, _posX: 0
	, _posY: 0
	, _dragable: null
	, _sensor: null // html object
	, _signal: null
	, constructor: function ( type ) {
		if ( !setter.isValidStr( type ) ) {
			this.err( 'constructor fail >> ' + type );
		}
		this._type = type;
		this.init();
	}
	, init: function () {
		this._inst = document.createElement( this._type );
		this._inst.style.position = "absolute";
		this._inst.style.left = 0;
		this._inst.style.top = 0;
		this._inst.style.transformOrigin = "0 0";
		
		this._data = {};
		this._signal = new Signal();
	}
	, dispose: function () {
		this.removeFromParent();
		this._data = null;
		this._inst = null;
		if ( this._dragable !== null ) {
			this._dragable.dispose();
			this._dragable = null;
		}
		this._sensor = null;
		if ( this._signal !== null ) {
			this._signal.dispose();
			this._signal = null;
		}
	}
	, clearData: function () {
		this._data = {};
	}
	, getData: function () {
		return this._data;
	}
	, getInst: function () {
		return this._inst;
	}
	, setParent: function ( parent ) {
		if ( !DisplayObject.isCreatorOf( parent ) ) {
			this.err( 'setParent fail' );
			return;
		}
		this._parent = parent;
	}
	, getPosX: function () {
		return this._posX;
	}
	, getPosY: function () {
		return this._posY;
	}
	, setPosX: function ( x ) {
		this._posX = setter.setInt( x, this._posX );
		this._inst.style.left = this._posX;
	}
	, setPosY: function ( y ) {
		this._posY = setter.setInt( y, this._posY );
		this._inst.style.top = this._posY;
	}
	, getDragable: function () {
		if ( this._dragable === null ) {
			this._dragable = new Dragable( this );
		}
		return this._dragable;
	}
	, getSensor: function () {
		if ( this._sensor !== null ) {
			return this._sensor;
		}
		return this._inst;
	}
	, setSensor: function ( obj ) {
		this._sensor = obj;
		this._signal.dispatch( { action: DisplayObject.ACTION_SENSOR_UPDATE } );
	}
	, getSignal: function () {
		return this._signal;
	}
	, removeFromParent: function () {
		if ( this._parent === null ) {
			return;
		}
		this._parent.removeChild( this );
		this._parent = null;
	}
});

var DragManager = (function () {
	var instance = {};
	
	var dragTarget = null;
	var dragX = 0;
	var dragY = 0;
	var prevX = 0;
	var prevY = 0;
	
	GlobalSignal.mouseMove.add( function ( e ) {
		/*
		if ( e.buttons === 0 ) {
			dragTarget = null;
		}
		*/
		
		if ( dragTarget === null ) {
			return;
		}
		
		dragTarget.update( { position: { x: e.pageX, y: e.pageY }, point: { x: dragX, y: dragY }, move: { x: e.pageX - prevX, y: e.pageY - prevY } } );
		prevX = e.pageX;
		prevY = e.pageY;
	});
	
	GlobalSignal.mouseUp.add( function ( e ) {
		dragTarget = null;
	});
	
	var setTarget = function ( dragable, e ) {
		dragTarget = dragable;
		var pos = dragTarget.getPos();
		dragX = pos.x - e.pageX;
		dragY = pos.y - e.pageY;
		prevX = e.pageX;
		prevY = e.pageY;
	};
	
	var unsetTarget = function ( dragable ) {
		if ( dragTarget === dragable ) {
			dragTarget = null;
		}
	};
	
	instance.setTarget = setTarget;
	instance.unsetTarget = unsetTarget;
	
	return instance;
} ());

var Dragable = buildClass({
	  TAG: 'Dragable'
	, __static__: {
		  ACTION_NULL: 'Dragable.ACTION_NULL'
		, ACTION_BEFORE_MOVE: 'Dragable.ACTION_BEFORE_MOVE'
		, ACTION_AFTER_MOVE: 'Dragable.ACTION_AFTER_MOVE'
	}
	, _inst: null
	, _signal: null
	, constructor: function ( inst ) {
		this._inst = inst;
		this.init();
	}
	, init: function () {
		this._signal = new Signal();
		this._inst.getSignal().add( function ( rslt ) {
			if ( rslt.action !== DisplayObject.ACTION_SENSOR_UPDATE ) {
				return;
			}
			self.updateSensor();
		});
	}
	, dispose: function () {
		this.enable( false );
		this._inst = null;
		if ( this._signal !== null ) {
			this._signal.dispose();
			this._signal = null;
		}
	}
	, getInst: function () {
		return this._inst;
	}
	, getPos: function () {
		return { x: this._inst.getPosX(), y: this._inst.getPosY() };
	}
	, getSignal: function () {
		return this._signal;
	}
	, enable: function ( value ) {
		if ( value ) {
			this.updateSensor();
		} else {
			var sensor = self._inst.getSensor();
			sensor.style.userSelect = '';
			sensor.style.userDrag = '';
			sensor.onselectstart = null;
			sensor.ondragstart = null;
			sensor.onmousedown = null;
			DragManager.unsetTarget( this );
		}
	}
	, update: function ( data ) {
		if ( !setter.isValidObj( data ) ) {
			this.err( 'update fail >> ' + data );
			return;
		}
		
		var position = data.position;
		var point = data.point;
		var move = data.move;
		if ( !setter.isValidObj( position ) ) {
			this.err( 'update fail >> position: ' + position );
			return;
		}
		
		var targetPos = { x: position.x + point.x, y: position.y + point.y };
		this._signal.dispatch( { action: Dragable.ACTION_BEFORE_MOVE, target: this, position: targetPos, move: move } );
		
		this._inst.setPosX( targetPos.x );
		this._inst.setPosY( targetPos.y );
		this._signal.dispatch( { action: Dragable.ACTION_AFTER_MOVE, target: this, position: targetPos, move: move } );
	}
	, updateSensor: function () {
		var self = this;
		var sensor = self._inst.getSensor();
	//	sensor.style.pointerEvents = "none";
		sensor.style.userSelect = 'none';
		sensor.style.userDrag = 'none';
		sensor.onselectstart = function () { return false; };
		sensor.ondragstart = function () { return false; };
		sensor.onmousedown = function ( e ) {
			DragManager.setTarget( self, e );
		};
	}
});

var Holder = buildClass({
	  TAG: 'Holder'
	, superClass: DisplayObject
	, _childList: null
	, constructor: function () {
		Holder.__super__.constructor.apply( this, ['div'] );
	}
	, init: function () {
		Holder.__super__.init.apply( this, arguments );
		
		this._childList = [];
	}
	, dispose: function () {
		if ( this._childList ) {
			while ( this._childList.length > 0 ) {
				this._childList[0].dispose();
			}
			this._childList = null;
		}
		
		Holder.__super__.dispose.apply( this, arguments );
	}
	, addChild: function ( child ) {
		if ( !DisplayObject.isCreatorOf( child ) ) {
			this.err( 'addChild fail' );
			return;
		}
		
		child.removeFromParent();
		this.getInst().appendChild( child.getInst() );
		child.setParent( this );
		this._childList.push( child );
	}
	, removeChild: function ( child ) {
		var index = this._childList.indexOf( child );
		if ( index < 0 ) {
			return;
		}
		
		this._childList.splice( index, 1 );
		this.getInst().removeChild( child.getInst() );
	}
});

var Quad = buildClass({
	  TAG: 'Quad'
	, superClass: DisplayObject
	, _width: 0
	, _height: 0
	, _color: ''
	, _alpha: 0
	, constructor: function ( width, height, color, alpha ) {
		this._width = setter.setInt( width, 0, { min: 0 } );
		this._height = setter.setInt( height, 0, { min: 0 } );
		this._color = setter.setStr( color );
		this._alpha = setter.setNum( alpha, 1, { min: 0, max: 1 } );
		Quad.__super__.constructor.apply( this, ['div'] );
	}
	, init: function () {
		Quad.__super__.init.apply( this, arguments );
		this._inst.style.width = this._width;
		this._inst.style.height = this._height;
		this._inst.style.backgroundColor = this._color;
	}
	, dispose: function () {
		Quad.__super__.dispose.apply( this, arguments );
	}
	, setColor: function ( value ) {
		this._color = setter.setStr( value );
		this._inst.style.backgroundColor = this._color;
	}
});

var Image = buildClass({
	  TAG: 'Image'
	, superClass: DisplayObject
	, _url: ''
	, constructor: function ( url ) {
		this._url = setter.setStr( url, '' );
		
		Image.__super__.constructor.apply( this, ['img'] );
	}
	, init: function () {
		Image.__super__.init.apply( this, arguments );
		
		this._inst.src = this._url;
	}
	, dispose: function () {
		Image.__super__.dispose.apply( this, arguments );
	}
});

var Drawer2D = buildClass({
	  TAG: 'Drawer2D'
	, superClass: DisplayObject
	, _width: 0
	, _height: 0
	, _ctx: null
	, constructor: function ( width, height ) {
		this._width = setter.setInt( width, 0, { min: 0 } );
		this._height = setter.setInt( height, 0, { min: 0 } );
		Drawer2D.__super__.constructor.apply( this, ['canvas'] );
	}
	, init: function () {
		Drawer2D.__super__.init.apply( this, arguments );
		this._inst.width = this._width;
		this._inst.height = this._height;
		this._ctx = this._inst.getContext( '2d' );
	}
	, dispose: function () {
		this._ctx = null;
		
		Drawer2D.__super__.dispose.apply( this, arguments );
	}
	, clear: function () {
		if ( this._ctx === null ) {
			return;
		}
		this._ctx.clearRect( 0, 0, this._inst.width, this._inst.height );
	}
	, drawCircle: function ( x, y, radius ) {
		if ( this._ctx === null ) {
			return;
		}
		this._ctx.beginPath();
		this._ctx.arc( setter.setNum( x ), setter.setNum( y ), setter.setNum( radius ) - 1, 0, 2 * Math.PI );
		this._ctx.stroke();
	}
	, drawLine: function ( x0, y0, x1, y1 ) {
		if ( this._ctx === null ) {
			return;
		}
		this._ctx.beginPath();
		this._ctx.moveTo( setter.setNum( x0 ) + 0.5, setter.setNum( y0 ) + 0.5 );
		this._ctx.lineTo( setter.setNum( x1 ) + 0.5, setter.setNum( y1 ) + 0.5 );
		this._ctx.stroke();
	}
	, drawRect: function ( x, y, width, height ) {
		if ( this._ctx === null ) {
			return;
		}
		this._ctx.beginPath();
		this._ctx.rect( setter.setNum( x ) + 0.5, setter.setNum( y ) + 0.5, setter.setNum( width ) - 1, setter.setNum( height ) - 1 );
		this._ctx.stroke();
	}
	, getImage: function () {
		var dataUrl = this._inst.toDataURL();
		var img = new Image( dataUrl );
		return img;
	}
	, resize: function ( width, height ) {
		this._width = setter.setInt( width, 0, { min: 0 } );
		this._height = setter.setInt( height, 0, { min: 0 } );
		this._inst.width = this._width;
		this._inst.height = this._height;
	}
});

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////
////////////////////////////////////////
////////////////////
//	Project
////////////////////
////////////////////////////////////////
////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////
/*
var ProjctA = buildClass({
	  TAG: 'ProjctA'
	, _inst: null
	, _parent: null
	, _circleMap: null
	, constructor: function ( parent ) {
		if ( !setter.isValidObj( parent ) ) {
			this.err( 'No parent' );
			return;
		}
		this._parent = parent;
		this.init();
	}
	, init: function () {
		var self = this;
		
		this._inst = new Quad( 0, 0, '#000000' );
		this._parent.appendChild( this._inst.getInst() );
		
		var quad = new Quad( 100, 100, '#ff0000' );
		quad.setPosX( 50 );
		quad.setPosY( 50 );
		quad.getDragable().enable( true );
		this._inst.getInst().appendChild( quad.getInst() );
		
		quad.getDragable().getSignal().add( function ( rslt ) {
			var target = rslt.target;
			var x = rslt.x;
			var y = rslt.y;
			if ( x > 1000 && x > target.getInst().getPosX() ) {
				target.stop();
			}
		});
		
		var angle = 0;
		var speed = 0.0005;

		var t = TimeCore.timer( function ( diff ) {
		//	log( diff );
			angle += ( speed ) % 1;
			var s = Math.sin( angle * Math.PI * 2 );
			var c = Math.cos( angle * Math.PI * 2 );
			sp.getInst().style.transform = "matrix(" + c + "," + s + "," + (-s) + "," + c + ",0,0)";
		}, 1 );
		// t.run();
		
		this._circleMap = {};
		
		var world = new GravityWorld();
		world.setRect( 0, 0, 960, 580 );
		world.setMaxSpeed( 5 );
		world.getSignal().add( function ( rslt ) {
			self.updateCircle( rslt );
		});
		
		world.addForce( new GravityForce_Point( { x: 480, y: 290 }, 0.05, true ) );
	//	world.addForce( new GravityForce_Point( { x: 200, y: 200 }, 0.05, true ) );
	//	world.addForce( new GravityForce_Point( { x: 600, y: 600 }, 0.05, true ) );
	//	world.addForce( new GravityForce_Earth( { x: 0, y: 0.05 }, true ) );
		
		for(var i = 0; i < 1; i++) {
			var item = new GravityItem( { x: 50 + Math.random() * 860, y: 50 + Math.random() * 480 },  { x: Math.random() * 3, y: Math.random() * 3 }, 1, 5 );
			var id = world.addItem( item );
			var circle = new Quad( 10, 10, '#888888' );
			this._inst.getInst().appendChild( circle.getInst() );
			this._circleMap[id] = circle;
		}
	}
	, dispose: function () {
		this._inst = null;
		this._parent = null;
	}
	, updateCircle: function ( data ) {
		var id = data.id;
		var x = data.x;
		var y = data.y;
		var vec = data.vec;
		var circle = this._circleMap[id];
		circle.setPosX( x - 5 );
		circle.setPosY( y - 5 );
		
		var c = Math.floor( (1 - vec.mag() / 5) * 100 );
		var cStr = "rgb(" + c + "%," + c + "%," + c + "%)";
	//	this.log( cStr );
		circle.setColor( cStr );
	}
});
*/

var ModelCore = buildClass({
	  TAG: 'ModelCore'
	, _commander: null
	, constructor: function ( commander ) {
		this._commander = commander;
		this.init();
	}
	, init: function () {
		;
	}
	, dispose: function () {
		this._commander = null;
	}
	, instruct: function ( action, data ) {
		if ( !this._commander ) {
			return;
		}
		
		this._commander.instruct( action, data );
	}
});

var ViewCore = buildClass({
	  TAG: 'ViewCore'
	, superClass: Holder
	, _commander: null
	, constructor: function ( commander ) {
		this._commander = commander;
		
		ViewCore.__super__.constructor.apply( this, [] );
	}
	, init: function () {
		ViewCore.__super__.init.apply( this, arguments );
	}
	, dispose: function () {
		this._commander = null;
		
		ViewCore.__super__.dispose.apply( this, arguments );
	}
	, instruct: function ( action, data ) {
		if ( !this._commander ) {
			return;
		}
		
		this._commander.instruct( action, data );
	}
});

var ProjectCore = buildClass({
	  TAG: 'ProjectCore'
	, superClass: Holder
	, _parent: null
	, constructor: function ( parent ) {
		if ( !setter.isValidObj( parent ) ) {
			this.err( 'No parent' );
			return;
		}
		this._parent = parent;
		ProjectCore.__super__.constructor.apply( this, [] );
		this.log( 'init() ready' );
	}
	, init: function () {
		ProjectCore.__super__.init.apply( this, arguments );
		
		this._parent.appendChild( this._inst );
	}
	, dispose: function () {
		this._parent = null;
		
		ProjectCore.__super__.dispose.apply( this, arguments );
	}
	, instruct: function ( action, data ) {
		;
	}
});

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////
////////////////////////////////////////
////////////////////
//	Components
////////////////////
////////////////////////////////////////
////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

var DragView = buildClass({
	  TAG: 'DragView'
	, superClass: ViewCore
	, __static__: {
		  ACTION_DRAG_ITEM: 'DragView.ACTION_DRAG_ITEM'
	}
	, _drawer: null
	, _itemMap: null
	, constructor: function ( commander ) {
		DragView.__super__.constructor.apply( this, arguments );
	}
	, init: function () {
		DragView.__super__.init.apply( this, arguments );
		
		this._drawer = new Drawer2D( 300, 150 );
		this._itemMap = {};
	}
	, dispose: function () {
		if ( this._drawer ) {
			this._drawer.dispose();
			this._drawer = null;
		}
		this._itemMap = null;
		
		DragView.__super__.dispose.apply( this, arguments );
	}
	, addItem: function ( id, inst, x, y ) {
		var sp = new Holder();
		sp.setSensor( inst.getInst() );
		sp.addChild( inst );
		sp.getData().id = id;
		sp.setPosX( x );
		sp.setPosY( y );
		this.addChild( sp );
		this._itemMap[id] = sp;
		
		var self = this;
		sp.getDragable().enable( true );
		sp.getDragable().getSignal().add( function ( rslt ) {
			self.onDrag( rslt );
		});
	}
	, addItemCircle: function ( id, x, y, radius ) {
		if ( !this._drawer ) {
			return;
		}
		this._drawer.clear();
		this._drawer.resize( radius * 2, radius * 2 );
		this._drawer.drawCircle( radius, radius, radius );
		var img = this._drawer.getImage();
		img.setPosX( -radius );
		img.setPosY( -radius );
		this.addItem( id, img, x, y );
	}
	, addItemRect: function ( id, x, y, width, height ) {
		if ( !this._drawer ) {
			return;
		}
		var cornerX = -width * 0.5;
		var cornerY = -height * 0.5;
		this._drawer.clear();
		this._drawer.resize( width, height );
		this._drawer.drawRect( 0, 0, width, height );
		var img = this._drawer.getImage();
		img.setPosX( cornerX );
		img.setPosY( cornerY );
		this.addItem( id, img, x, y );
	}
	, onDrag: function ( rslt ) {
		var action = rslt.action;
		var target = rslt.target;
		var pos = rslt.position;
		var sp = target.getInst();
		var id = sp.getData().id;
		switch ( action ) {
		case Dragable.ACTION_BEFORE_MOVE:
			break;
		case Dragable.ACTION_AFTER_MOVE:
			this.instruct( DragView.ACTION_DRAG_ITEM, { id: id, x: pos.x, y: pos.y } );
			break;
		default:
			;
		}
	}
	, update: function ( id, x, y ) {
		if ( !this._itemMap ) {
			return;
		}
		var sp = this._itemMap[id];
		if ( !sp ) {
			return;
		}
		sp.setPosX( x );
		sp.setPosY( y );
	} 
});

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////
////////////////////////////////////////
////////////////////
//	ProjctModelViewTest
////////////////////
////////////////////////////////////////
////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

var ProjctModelViewTest = (function () {
	
////////////////////////////////////////////////////////////
////////////////////////////////////////
////////////////////
//	Model
////////////////////
////////////////////////////////////////
////////////////////////////////////////////////////////////
	
	var CollideModel = buildClass({
		  TAG: 'CollideModel'
		, superClass: ModelCore
		, __static__: {
			  ACTION_ADD_ITEM: 'CollideModel.ACTION_ADD_ITEM'
			, ACTION_UPDATE_POS: 'CollideModel.ACTION_UPDATE_POS'
		}
		, _itemList: null
		, constructor: function ( commander ) {
			CollideModel.__super__.constructor.apply( this, arguments );
		}
		, init: function () {
			CollideModel.__super__.init.apply( this, arguments );
			
			this._itemList = [];
		}
		, dispose: function () {
			CollideModel.__super__.dispose.apply( this, arguments );
		}
		, addItemCircle: function ( x, y, radius ) {
			if ( !this._itemList ) {
				return;
			}
			
			var id = this._itemList.length;
			var plane = new Plane2D_Circle( radius );
			plane.setPos( { x: x, y: y } );
			this._itemList.push( plane );
			this.instruct( CollideModel.ACTION_ADD_ITEM, { id: id, shape: plane.getShape(), x: x, y: y, radius: radius } );
		}
		, addItemRect: function ( x, y, width, height ) {
			if ( !this._itemList ) {
				return;
			}
			
			var id = this._itemList.length;
			var cornerX = -width * 0.5;
			var cornerY = -height * 0.5;
			var plane = new Plane2D_Rect( width, height, cornerX, cornerY );
			plane.setPos( { x: x, y: y } );
			this._itemList.push( plane );
			this.instruct( CollideModel.ACTION_ADD_ITEM, { id: id, shape: plane.getShape(), x: x, y: y, width: width, height: height } );
		}
		, addItemWall: function ( x, y, dir ) {
			if ( !this._itemList ) {
				return;
			}
			
			var id = this._itemList.length;
			var plane = new Plane2D_Wall();
			plane.setDir( dir );
			plane.setPos( { x: x, y: y } );
			this._itemList.push( plane );
			this.instruct( CollideModel.ACTION_ADD_ITEM, { id: id, shape: plane.getShape(), x: x, y: y, dir: dir } );
		}
		, updatePos: function ( id, x, y ) {
			if ( !this._itemList ) {
				return;
			}
			if ( !setter.isValidInt( id ) ) {
				return;
			}
			if ( id < 0 || id >= this._itemList.length ) {
				return;
			}
			
			var pos = { x: x, y: y };
			var item = this._itemList[id];
			var itemTest = item.clone();
			itemTest.setPos( pos );
			for(var i = 0; i < this._itemList.length; i++) {
				if ( i === id ) {
					continue;
				}
				
				var item2 = this._itemList[i];
				if ( itemTest.isOverlap( item2 ) ) {
					pos = item.getPos();
					break;
				}
			}
			item.setPos( pos );
			
			this.instruct( CollideModel.ACTION_UPDATE_POS, { id: id, x: pos.x, y: pos.y } );
		}
	});
	
////////////////////////////////////////////////////////////
////////////////////////////////////////
////////////////////
//	View
////////////////////
////////////////////////////////////////
////////////////////////////////////////////////////////////
	
////////////////////////////////////////////////////////////
////////////////////////////////////////
////////////////////
//	Main
////////////////////
////////////////////////////////////////
////////////////////////////////////////////////////////////
	
	return buildClass({
		  TAG: 'ProjctModelViewTest'
		, superClass: ProjectCore
		, _dragView: null
		, _collideModel: null
		, constructor: function ( parent ) {
			ProjctModelViewTest.__super__.constructor.apply( this, arguments );
		}
		, init: function () {
			ProjctModelViewTest.__super__.init.apply( this, arguments );
			
			this._collideModel = new CollideModel( this );
			this._dragView = new DragView( this );
			
			this.addChild( this._dragView );
			
			this._collideModel.addItemCircle( 100, 100, 20 );
			this._collideModel.addItemCircle( 200, 100, 20 );
			this._collideModel.addItemRect( 100, 200, 40, 40 );
			this._collideModel.addItemRect( 200, 200, 40, 40 );
			this._collideModel.addItemWall( 0, 300, { x: 1, y: 0 } );
			this._collideModel.addItemWall( 500, 0, { x: 0, y: 1 } );
			this._collideModel.addItemWall( 1000, 300, { x: -1, y: 0 } );
			this._collideModel.addItemWall( 500, 600, { x: 0, y: -1 } );
		}
		, dispose: function () {
			if ( this._collideModel ) {
				this._collideModel.dispose();
				this._collideModel = null;
			}
			if ( this._dragView ) {
				this._dragView.dispose();
				this._dragView = null;
			}
			
			ProjctModelViewTest.__super__.dispose.apply( this, arguments );
		}
		, instruct: function ( action, data ) {
			this.log( 'instruct >> ' + action + ', ' + JSON.stringify( data ) );
			switch ( action ) {
			case CollideModel.ACTION_ADD_ITEM:
				var id = data.id;
				var shape = data.shape;
				var x = data.x;
				var y = data.y;
				switch ( shape ) {
				case Plane2D_Circle.SHAPE:
					this._dragView.addItemCircle( id, x, y, data.radius );
					break;
				case Plane2D_Rect.SHAPE:
					this._dragView.addItemRect( id, x, y, data.width, data.height );
					break;
				default:
					this.log( 'Unknown add item >> ' + shape );
				}
				break;
			case CollideModel.ACTION_UPDATE_POS:
				var id = data.id;
				var x = data.x;
				var y = data.y;
				this._dragView.update( id, x, y );
				break;
			case DragView.ACTION_DRAG_ITEM:
				var id = data.id;
				var x = data.x;
				var y = data.y;
				this._collideModel.updatePos( id, x, y );
				break;
			default:
				this.log( 'Unknown action >> ' + action );
			}
		}
	});
} ());

////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////
////////////////////////////////////////
////////////////////
//	ProjctCollideTest
////////////////////
////////////////////////////////////////
////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

var ProjctCollideTest = (function () {
	
////////////////////////////////////////////////////////////
////////////////////////////////////////
////////////////////
//	Model
////////////////////
////////////////////////////////////////
////////////////////////////////////////////////////////////
	
	var GravityItem = buildClass({
		  TAG: 'GravityItem'
		, _id: 0
		, _mass: 0
		, _plane: null
		, _vec: null
		, _vecAfter: null
		, constructor: function ( id, plane, vec, mass ) {
			if ( !Plane2D.isCreatorOf( plane ) ) {
				this.err( 'constructor fail >> plane: ' + plane );
			}
			
			this._id = setter.setInt( id, 0, { min: 0 } );
			this._plane = plane;
			this._vec = Vec2.createFromObj( vec );
			this._mass = setter.setNum( mass, 0, { min: 0 } );
			
			this.init();
		}
		, init: function () {
			;
		}
		, dispose: function () {
			if ( this._plane ) {
				this._plane.dispose();
				this._plane = null;
			}
			this._vec = null;
			this._vecAfter = null;
		}
		, getId: function () {
			return this._id;
		}
		, getMass: function () {
			return this._mass;
		}
		, getPlane: function () {
			return this._plane;
		}
		, getPos: function () {
			return this._plane.getPos();
		}
		, getVec: function () {
			return this._vec.clone();
		}
		, accelerate: function ( value ) {
			this._vec.addEql( value );
		}
		, preCalc: function () {
			this._vecAfter = null;
		}
		// value: unit vector
		, blockDir: function ( value ) {
			var testDir = this._vecAfter;
			if ( testDir === null ) {
				testDir = this._vec;
			}
			
			// same dir, no block
			var testDot = testDir.dot( value );
			if ( testDot >= 0 ) {
				return;
			}
			
			if ( this._vecAfter !== null ) {
				this._vecAfter = new Vec2();
				return;
			}
			
			var minusVec = value.mul( testDot );
			this._vecAfter = this._vec.minus( minusVec );
		}
		/*
		, isCloseTo: function ( pos0, pos1, vec0, vec1 ) {
			var dir0 = pos1.minus( pos0 );
			var dir1 = vec0.minus( vec1 );
			return ( dir0.dot( dir1 ) > 0 );
		}
		*/
		, isCloseTo: function ( target ) {
			var vecDir = this._vec.minus( target._vec );
			var posDir = new Vec2();
			if ( Plane2D_Wall.isCreatorOf( this._plane ) ) {
				if ( Plane2D_Wall.isCreatorOf( target._plane ) ) {
					// to do
				} else {
					posDir = this._plane.getDir();
					var dir0 = pos1.minus( pos0 );
					var dir1 = vec0.minus( vec1 );
				}
			}
			return ( posDir.dot( vecDir ) > 0 );
		}
		, collide: function ( target ) {
			if ( this._mass + target._mass <= 0 ) {
				return;
			}
			if ( !this._plane.isOverlap( target._plane ) ) {
				return;
			}
			var pos0 = this.getPos();
			var pos1 = target.getPos();
			// to do
		//	if ( !this.isCloseTo( pos0, pos1, this._vec, target._vec ) ) {
			if ( !this.isCloseTo( target ) ) {
				return;
			}
			var dir = pos1.minus( pos0 ).normalize();
			if ( Plane2D_Wall.isCreatorOf( target._plane ) ) {
				dir = target._plane.getDir();
			} else if ( Plane2D_Wall.isCreatorOf( this._plane ) ) {
				dir = this._plane.getDir();
			}
			
			var speed0 = this._vec.dot( dir );
			var speed1 = target._vec.dot( dir );
			
			var speedAfter0 = 0;
			var speedAfter1 = 0;
			if ( this._mass > 0 && target._mass > 0 ) {
				speedAfter0 = ( speed0 * ( 0 + this._mass - target._mass ) + 2 * target._mass * speed1 ) / ( this._mass + target._mass );
				speedAfter1 = ( speed1 * ( 0 - this._mass + target._mass ) + 2 *   this._mass * speed0 ) / ( this._mass + target._mass );
			} else if ( this._mass > 0 ) {
				speedAfter0 = ( speed0 * ( -1 ) + 2 * speed1 );
				speedAfter1 = speed1;
			} else if ( target._mass > 0 ) {
				speedAfter0 = speed0;
				speedAfter1 = ( speed1 * ( -1 ) + 2 * speed0 );
			} else {
				speedAfter0 = speed0;
				speedAfter1 = speed1;
			}
			
			this._vec.addEql( dir.mul( speedAfter0 - speed0 ) );
			target._vec.addEql( dir.mul( speedAfter1 - speed1 ) );
		}
		, limitSpeed: function ( p_value ) {
			var value = setter.setNum( p_value, 0, { min: 0 } );
			if ( value <= 0 ) {
				this._vec = new Vec2();
				return;
			}
			var mag = this._vec.mag();
			if ( mag > value ) {
				this._vec.normalize();
				this._vec.mulEql( value );
			}
		}
		, beBlocked: function ( target ) {
			if ( !GravityItem.isCreatorOf( target ) ) {
				this.err( 'beBlocked fail >> ' + target );
				return;
			}
			if ( !this._plane.isOverlap( target._plane ) ) {
				return;
			}
			var pos0 = this.getPos();
			var pos1 = target.getPos();
			this.blockDir( pos0.minus( pos1 ).normalize() );
		}
		, impCalc: function () {
			var pos = this._plane.getPos();
			if ( this._vecAfter === null ) {
				pos.addEql( this._vec );
			} else {
				pos.addEql( this._vecAfter );
			}
			this._plane.setPos( pos );
		}
	});

	var GravityForce = buildClass({
		  TAG: 'GravityForce'
		, constructor: function () {
			this.init();
		}
		, init: function () {
			;
		}
		, dispose: function () {
			;
		}
		, calcAcc: function ( pos, mass ) {
			return new Vec2();
		}
	});

	var GravityForce_Point = buildClass({
		  TAG: 'GravityForce_Point'
		, superClass: GravityForce
		, _pos: null
		, _mag: 0
		, _isConst: false
		, constructor: function ( pos, mag, isConst ) {
			this._pos = Vec2.createFromObj( pos );
			this._mag = setter.setNum( mag, 0 );
			this._isConst = setter.setBool( isConst, false );
			this.init();
		}
		, init: function () {
			;
		}
		, dispose: function () {
			this._pos = null;
		}
		, calcAcc: function ( pos, p_mass ) {
			var mass = setter.setNum( p_mass, 0 );
			
			var rslt = new Vec2();
			if ( this._pos === null || mass === 0 ) {
				return rslt;
			}
			
			rslt = this._pos.minus( pos ).normalize().mul( this._mag );
			if ( !this._isConst ) {
				rslt.divEql( mass );
			}
			
			return rslt;
		}
	});

	var GravityForce_Earth = buildClass({
		  TAG: 'GravityForce_Earth'
		, superClass: GravityForce
		, _force: null
		, _isConst: false
		, constructor: function ( force, isConst ) {
			this._force = Vec2.createFromObj( force );
			this._isConst = setter.setBool( isConst, false );
			this.init();
		}
		, init: function () {
			;
		}
		, dispose: function () {
			this._force = null;
		}
		, calcAcc: function ( pos, p_mass ) {
			var rslt = new Vec2();
			if ( this._force === null ) {
				return rslt;
			}
			
			rslt = this._force.clone();
			if ( !this._isConst ) {
				var mass = setter.setNum( p_mass, 0 );
				if ( mass === 0 ) {
					rslt = new Vec2();
				} else {
					rslt.divEql( mass );
				}
			}
			
			return rslt;
		}
	});
	
	var GravityModel = buildClass({
		  TAG: 'GravityModel'
		, superClass: ModelCore
		, __static__: {
			  ACTION_ADD_ITEM: 'GravityModel.ACTION_ADD_ITEM'
			, ACTION_UPDATE_POS: 'GravityModel.ACTION_UPDATE_POS'
			, ITEM_CIRCLE: 'GravityModel.ITEM_CIRCLE'
			, ITEM_RECT: 'GravityModel.ITEM_RECT'
		}
		, _maxSpeed: 0
		, _nextForceId: 0
		, _nextItemId: 0
		, _wall: null
		, _force: null
		, _child: null
		, _timer: null
		, constructor: function () {
			GravityModel.__super__.constructor.apply( this, arguments );
		}
		, init: function () {
			GravityModel.__super__.init.apply( this, arguments );
			
			var self = this;
			this._maxSpeed = 0;
			this._nextForceId = 0;
			this._nextItemId = 0;
			this._child = [];
			this._force = [];
			this._wall = [];
			
			var plane = null;
			/*
			plane = new Plane2D_Wall();
			plane.setDir( { x:  1, y:  0 } );
			this._wall.push( new GravityItem( this.createItemId(), plane, { x: 0, y: 0 }, 0 ) );
			plane = new Plane2D_Wall();
			plane.setDir( { x:  0, y:  1 } );
			this._wall.push( new GravityItem( this.createItemId(), plane, { x: 0, y: 0 }, 0 ) );
			plane = new Plane2D_Wall();
			plane.setDir( { x: -1, y:  0 } );
			this._wall.push( new GravityItem( this.createItemId(), plane, { x: 0, y: 0 }, 0 ) );
			*/
			plane = new Plane2D_Wall();
			plane.setDir( { x:  0, y: -1 } );
			this._wall.push( new GravityItem( this.createItemId(), plane, { x: 0, y: 0 }, 0 ) );
			
			for(var i = 0; i < this._wall.length; i++) {
				this._child.push( this._wall[i] );
			}
			this._timer = TimeCore.timer( function ( diff ) {
				self.run( diff );
			}, 1 );
			this._timer.run();
		}
		, dispose: function () {
			if ( this._child !== null ) {
				while ( this._child.length > 0 ) {
					var item = this._child.pop();
					item.dispose();
				}
				this._child = null;
			}
			if ( this._force !== null ) {
				while ( this._force.length > 0 ) {
					var item = this._force.pop();
					item.dispose();
				}
				this._force = null;
			}
			this._wall = null;
			if ( this._timer !== null ) {
				this._timer.dispose();
				this._timer = null;
			}
			
			GravityModel.__super__.dispose.apply( this, arguments );
		}
		, createForceId: function () {
			this._nextForceId++;
			return this._nextForceId;
		}
		, createItemId: function () {
			this._nextItemId++;
			return this._nextItemId;
		}
		, setMaxSpeed: function ( value ) {
			this._maxSpeed = setter.setNum( value, 0, { min: 0 } );
		}
		, setRect: function ( p_x, p_y, p_w, p_h ) {
			if ( !this._wall ) {
				return;
			}
			var x = setter.setInt( p_x, 0, { min: 0 } );
			var y = setter.setInt( p_y, 0, { min: 0 } );
			var w = setter.setInt( p_w, 0, { min: 0 } );
			var h = setter.setInt( p_h, 0, { min: 0 } );
			/*
			this._wall[0].getPlane().setPos( { x: x + w * 0.0, y: y + h * 0.5 } );
			this._wall[1].getPlane().setPos( { x: x + w * 0.5, y: y + h * 0.0 } );
			this._wall[2].getPlane().setPos( { x: x + w * 1.0, y: y + h * 0.5 } );
			this._wall[3].getPlane().setPos( { x: x + w * 0.5, y: y + h * 1.0 } );
			*/
			this._wall[0].getPlane().setPos( { x: x + w * 0.5, y: y + h * 1.0 } );
		}
		, addForce: function ( obj ) {
			if ( this._force === null ) {
				return -1;
			}
			if ( !setter.isValidObj( obj ) ) {
				return -1;
			}
			
			var id = this._force.length;
			this._force.push( obj );
			return id;
		}
		, addItem: function ( plane, x, y, vec, mass ) {
			if ( this._child === null ) {
				return;
			}
			if ( !setter.isValidObj( plane ) ) {
				return;
			}
			
			var id = this.createItemId();
			plane.setPos( { x: setter.setNum( x ), y: setter.setNum( y ) } );
			var item = new GravityItem( id, plane, Vec2.createFromObj( vec ), setter.setNum( mass, 0, { min: 0 } ) );
			this._child.push( item );
			this.instruct( GravityModel.ACTION_ADD_ITEM, { id: id, plane: plane } );
		}
		, collision: function ( child0, child1 ) {
			child0.collide( child1 );
		}
		, blockCheck: function ( child0, child1 ) {
			child0.beBlocked( child1 );
			child1.beBlocked( child0 );
		}
		, procBeginCalc: function () {
			for(var i = 0; i < this._child.length; i++) {
				var item = this._child[i];
				item.preCalc();
			}
		}
		, procRunForce: function () {
			for(var j = 0; j < this._force.length; j++) {
				var force = this._force[j];
				for(var i = 0; i < this._child.length; i++) {
					var item = this._child[i];
					var accVtr = force.calcAcc( item.getPos(), item.getMass() );
				//	if ( i < 4 ) {
					if ( i < 1 ) {
						continue;
					}
					item.accelerate( accVtr );
				}
			}
		}
		, procRunCollide: function () {
			looper.pairs( this._child, this.collision );
		}
		, procFixSpeed: function () {
			for(var i = 0; i < this._child.length; i++) {
				var item = this._child[i];
				item.limitSpeed( this._maxSpeed );
			}
		}
		, procRunBlock: function () {
			looper.pairs( this._child, this.blockCheck );
		}
		, procEndCalc: function () {
			for(var i = 0; i < this._child.length; i++) {
				var item = this._child[i];
				if ( item.getPos().y > 600 ) {
					a = false;
					continue;
				}
				item.impCalc();
			}
		}
		, procUpdate: function () {
			for(var i = 0; i < this._child.length; i++) {
				var item = this._child[i];
				var id = item.getId();
				var pos = item.getPos();
				this.instruct( GravityModel.ACTION_UPDATE_POS, { id: id, x: pos.x, y: pos.y } );
			}
		}
		, run: function ( diff ) {
			this.procBeginCalc();
			this.procRunForce();
			this.procRunCollide();
			this.procFixSpeed();
			this.procRunBlock();
			this.procEndCalc();
			this.procUpdate();
		}
		, updatePos: function ( id, x, y ) {
			// to do
		/*
			if ( !this._itemList ) {
				return;
			}
			if ( !setter.isValidInt( id ) ) {
				return;
			}
			if ( id < 0 || id >= this._itemList.length ) {
				return;
			}
			
			var pos = { x: x, y: y };
			var item = this._itemList[id];
			var itemTest = item.clone();
			itemTest.setPos( pos );
			for(var i = 0; i < this._itemList.length; i++) {
				if ( i === id ) {
					continue;
				}
				
				var item2 = this._itemList[i];
				if ( itemTest.isOverlap( item2 ) ) {
					pos = item.getPos();
					break;
				}
			}
			item.setPos( pos );
			
			this.instruct( CollideModel.ACTION_UPDATE_POS, { id: id, x: pos.x, y: pos.y } );
			*/
		}
	});
	
////////////////////////////////////////////////////////////
////////////////////////////////////////
////////////////////
//	View
////////////////////
////////////////////////////////////////
////////////////////////////////////////////////////////////
	
	
	
////////////////////////////////////////////////////////////
////////////////////////////////////////
////////////////////
//	Main
////////////////////
////////////////////////////////////////
////////////////////////////////////////////////////////////
	
	return buildClass({
		  TAG: 'ProjctCollideTest'
		, superClass: ProjectCore
		, _dragView: null
		, _gravityModel: null
		, constructor: function ( parent ) {
			ProjctCollideTest.__super__.constructor.apply( this, arguments );
		}
		, init: function () {
			ProjctCollideTest.__super__.init.apply( this, arguments );
			
			this._gravityModel = new GravityModel( this );
			this._dragView = new DragView( this );
			this.addChild( this._dragView );
			
			this._gravityModel.setMaxSpeed( 5 );
			this._gravityModel.setRect( 0, 0, 1000, 500 );
			
		//	this._gravityModel.addItem( new Plane2D_Circle( 20 ), 30, 100, 1 );
		//	this._gravityModel.addItem( new Plane2D_Circle( 20 ), 200, 100, 1 );
		//	this._gravityModel.addItem( new Plane2D_Rect( 40, 40, -20, -20 ), 25, 50, 1 );
			this._gravityModel.addItem( new Plane2D_Rect( 40, 40, -20, -20 ), 200, 450, { x: 2, y: 2 }, 1 );
			this._gravityModel.addForce( new GravityForce_Earth( { x: 0, y: 0.05 }, true ) );
			/*

			var plane = new Plane2D_Circle( radius );
			plane.setPos( { x: x, y: y } );
			addItem: function ( plane, x, y, mass ) {
			this._gravityModel.addItemCircle( 100, 100, 20 );
			this._gravityModel.addItemCircle( 200, 100, 20 );
			this._gravityModel.addItemRect( 100, 200, 40, 40 );
			this._gravityModel.addItemRect( 200, 200, 40, 40 );
			*/
			
			/*
			var world = new GravityWorld();
			world.setRect( 0, 0, 960, 580 );
			world.setMaxSpeed( 5 );
			world.getSignal().add( function ( rslt ) {
				self.updateCircle( rslt );
			});
			
			world.addForce( new GravityForce_Point( { x: 480, y: 290 }, 0.05, true ) );
		//	world.addForce( new GravityForce_Point( { x: 200, y: 200 }, 0.05, true ) );
		//	world.addForce( new GravityForce_Point( { x: 600, y: 600 }, 0.05, true ) );
		//	world.addForce( new GravityForce_Earth( { x: 0, y: 0.05 }, true ) );
			
			for(var i = 0; i < 1; i++) {
				var item = new GravityItem( { x: 50 + Math.random() * 860, y: 50 + Math.random() * 480 },  { x: Math.random() * 3, y: Math.random() * 3 }, 1, 5 );
				var id = world.addItem( item );
				var circle = new Quad( 10, 10, '#888888' );
				this._inst.getInst().appendChild( circle.getInst() );
				this._circleMap[id] = circle;
			}
			*/
		}
		, dispose: function () {
			if ( this._gravityModel ) {
				this._gravityModel.dispose();
				this._gravityModel = null;
			}
			if ( this._dragView ) {
				this._dragView.dispose();
				this._dragView = null;
			}
			
			ProjctCollideTest.__super__.dispose.apply( this, arguments );
		}
		, instruct: function ( action, data ) {
			switch ( action ) {
			case GravityModel.ACTION_ADD_ITEM:
				var id = data.id;
				var plane = data.plane;
				var shape = plane.getShape();
				var pos = plane.getPos();
				var x = pos.x;
				var y = pos.y;
				switch ( shape ) {
				case Plane2D_Circle.SHAPE:
					this._dragView.addItemCircle( id, x, y, plane.getRadius() );
					break;
				case Plane2D_Rect.SHAPE:
					var size = plane.getSize();
					this._dragView.addItemRect( id, x, y, size.x, size.y );
					break;
				default:
					this.log( 'Unknown add item >> ' + shape );
				}
				break;
			case GravityModel.ACTION_UPDATE_POS:
				var id = data.id;
				var x = data.x;
				var y = data.y;
				this._dragView.update( id, x, y );
				break;
			case DragView.ACTION_DRAG_ITEM:
				var id = data.id;
				var x = data.x;
				var y = data.y;
				this._gravityModel.updatePos( id, x, y );
				break;
			default:
				this.log( 'Unknown action >> ' + action );
			}
		}
	});
} ());

// new ProjctModelViewTest( document.body );
new ProjctCollideTest( document.body );

// new ProjctA( document.body );

<!-- Notices -->
/*

*/

<!-- Testing Area -->
/*
var r0 = 150;
var r1 = 50;
var cx = 200;
var cy = 200;
var drawer = new Drawer2D( cx * 2, cy * 4 );
drawer.clear();
document.body.appendChild( drawer.getInst() );

var cut = 1000;
var x0 = 0;
var y0 = 0;
for(var i = 0; i <= cut; i++) {
	var x = r0 * i / cut;
	var y = Math.sqrt( r0 * r0 - x * x ) * r1 / r0;
	drawer.drawLine( x, 0, x, y );
	if ( i > 0 ) {
		var len = Math.sqrt( (x0 - x) * (x0 - x) + (y0 - y) * (y0 - y) );
		
		drawer.drawLine( x + cx, 0, x + cx, 10 / len );
	}
	x0 = x;
	y0 = y;
}
*/
</script>
</html>